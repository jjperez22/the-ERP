<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="description" content="Comprehensive construction project management and ERP system for managing projects, inventory, finances, and human resources.">
    <title>Construction ERP - Project Management System</title>
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="/manifest.json">
    
    <!-- Theme Colors -->
    <meta name="theme-color" content="#1FB8CD">
    <meta name="msapplication-TileColor" content="#1FB8CD">
    <meta name="msapplication-config" content="/browserconfig.xml">
    
    <!-- iOS PWA Support -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Construction ERP">
    <link rel="apple-touch-icon" href="/assets/icons/icon-192x192.png">
    <link rel="apple-touch-startup-image" href="/assets/icons/icon-512x512.png">
    
    <!-- Icons -->
    <link rel="icon" type="image/svg+xml" href="/favicon.svg">
    <link rel="icon" type="image/png" sizes="32x32" href="/assets/icons/icon-72x72.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/assets/icons/icon-72x72.png">
    <link rel="shortcut icon" href="/favicon.svg">
    
    <!-- Microsoft Tiles -->
    <meta name="msapplication-square70x70logo" content="/assets/icons/icon-72x72.png">
    <meta name="msapplication-square150x150logo" content="/assets/icons/icon-152x152.png">
    <meta name="msapplication-wide310x150logo" content="/assets/icons/icon-384x384.png">
    <meta name="msapplication-square310x310logo" content="/assets/icons/icon-384x384.png">
    
    <!-- Open Graph / Social Media -->
    <meta property="og:type" content="website">
    <meta property="og:title" content="Construction ERP - Project Management System">
    <meta property="og:description" content="Comprehensive construction project management and ERP system for managing projects, inventory, finances, and human resources.">
    <meta property="og:image" content="/assets/icons/icon-512x512.png">
    <meta property="og:url" content="https://construction-erp-demo.com">
    
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Construction ERP - Project Management System">
    <meta name="twitter:description" content="Comprehensive construction project management and ERP system">
    <meta name="twitter:image" content="/assets/icons/icon-512x512.png">
    
    <!-- Security Headers -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="referrer" content="strict-origin-when-cross-origin">
    
    <!-- Performance Hints -->
    <link rel="preconnect" href="https://cdn.jsdelivr.net">
    <link rel="dns-prefetch" href="https://cdn.jsdelivr.net">
    
    <!-- Stylesheets -->
    <link rel="stylesheet" href="style.css">
    
    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Role Management and Widget Systems -->
    <script src="role-manager.js"></script>
    <script src="dashboard-widgets.js"></script>
    
    <!-- Security and Encryption Services -->
    <script src="security-manager.js"></script>
    <script src="audit-logger.js"></script>
    <script src="encryption-service.js"></script>
    
    <!-- Analytics and Chart Library -->
    <script src="analytics-engine-core.js"></script>
    <script src="chart-library-foundation.js"></script>
    <script src="chart-basic-types.js"></script>
    <script src="chart-interactivity.js"></script>
    <script src="chart-tooltips.js"></script>
    
    <!-- Dashboard System -->
    <script src="dashboard-foundation.js"></script>
    
    <!-- AI Analytics and Query Interface -->
    <script src="ai-insights-data.js"></script>
    <script src="ai-insights-display.js"></script>
    <script src="ai-query-interface.js"></script>
    <script src="ai-analytics-tabs.js"></script>
    
    <!-- Main Application Script (CRITICAL - was missing!) -->
    <script src="app.js"></script>
</head>
<body>
    <!-- Login Page (initially visible) -->
    <div id="loginPage" class="login-page">
        <div class="login-container">
            <div class="login-header">
                <div class="login-brand">
                    <div class="brand-icon">🏗️</div>
                    <h1>ConstructERP</h1>
                    <p>Smart ERP for Construction Materials</p>
                </div>
            </div>
            
            <div class="login-form-container">
                <form id="loginForm" class="login-form">
                    <h2>Welcome Back</h2>
                    <p class="login-subtitle">Please sign in to your account</p>
                    
                    <div class="form-group">
                        <label class="form-label">Email Address</label>
                        <input type="email" id="loginEmail" class="form-control" placeholder="Enter your email" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Password</label>
                        <input type="password" id="loginPassword" class="form-control" placeholder="Enter your password" required>
                    </div>
                    
                    <div class="form-group form-options">
                        <label class="checkbox-label">
                            <input type="checkbox" id="rememberMe">
                            <span class="checkmark"></span>
                            Remember me
                        </label>
                        <a href="#" class="forgot-password">Forgot Password?</a>
                    </div>
                    
                    <button type="submit" class="btn btn--primary btn--full-width login-btn">Sign In</button>
                    
                    <div class="login-divider">
                        <span>Demo Accounts</span>
                    </div>
                    
                    <div class="demo-accounts">
                        <button type="button" class="demo-account-btn" data-role="admin" data-email="admin@constructerp.com">
                            👨‍💼 Admin Login
                            <small>Full access to all features</small>
                        </button>
                        <button type="button" class="demo-account-btn" data-role="manager" data-email="manager@constructerp.com">
                            👩‍💼 Manager Login
                            <small>Orders, inventory, and reports</small>
                        </button>
                        <button type="button" class="demo-account-btn" data-role="employee" data-email="employee@constructerp.com">
                            👨‍🔧 Employee Login
                            <small>Basic inventory and orders</small>
                        </button>
                    </div>
                </form>
                
                <div class="login-footer">
                    <p>&copy; 2025 ConstructERP. All rights reserved.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Main App (initially hidden) -->
    <div id="mainApp" class="main-app" style="display: none;">
    <header class="header">
        <div class="header-container">
            <div class="header-brand">
                <button class="mobile-nav-toggle" id="mobileNavToggle">☰</button>
                <h1>ConstructERP</h1>
                <span class="header-tagline">Smart ERP for Construction Materials</span>
            </div>
            <div class="header-actions">
                <button class="btn btn--primary btn--sm" id="quickOrderBtn">+ Quick Order</button>
                <div class="user-menu">
                    <span>John Smith</span>
                </div>
            </div>
        </div>
    </header>

    <nav class="sidebar" id="sidebar">
        <ul class="sidebar-nav">
            <li class="nav-item active" data-module="dashboard">
                <span class="nav-icon">📊</span>
                <span class="nav-text">Dashboard</span>
            </li>
            <li class="nav-item" data-module="inventory">
                <span class="nav-icon">📦</span>
                <span class="nav-text">Inventory</span>
            </li>
            <li class="nav-item" data-module="customers">
                <span class="nav-icon">👥</span>
                <span class="nav-text">Customers</span>
            </li>
            <li class="nav-item" data-module="orders">
                <span class="nav-icon">📋</span>
                <span class="nav-text">Orders</span>
            </li>
            <li class="nav-item" data-module="financial">
                <span class="nav-icon">💰</span>
                <span class="nav-text">Financial</span>
            </li>
            <li class="nav-item" data-module="supply-chain">
                <span class="nav-icon">🚚</span>
                <span class="nav-text">Supply Chain</span>
            </li>
            <li class="nav-item" data-module="insights">
                <span class="nav-icon">🧠</span>
                <span class="nav-text">AI Insights</span>
            </li>
            <li class="nav-item" data-module="reports">
                <span class="nav-icon">📈</span>
                <span class="nav-text">Reports</span>
            </li>
        </ul>
    </nav>

    <main class="main-content">
        <!-- Dashboard Module -->
        <div id="dashboard" class="module active">
            <div class="module-header">
                <h2>Dashboard Overview</h2>
                <div class="date-display">Today: August 16, 2025</div>
            </div>

            <div class="kpi-grid">
                <div class="kpi-card">
                    <div class="kpi-icon">💰</div>
                    <div class="kpi-content">
                        <div class="kpi-value">$234,567</div>
                        <div class="kpi-label">Monthly Revenue</div>
                        <div class="kpi-change positive">+12.5%</div>
                    </div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-icon">📦</div>
                    <div class="kpi-content">
                        <div class="kpi-value">156</div>
                        <div class="kpi-label">Total Orders</div>
                        <div class="kpi-change positive">+8.3%</div>
                    </div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-icon">👥</div>
                    <div class="kpi-content">
                        <div class="kpi-value">89</div>
                        <div class="kpi-label">Active Customers</div>
                        <div class="kpi-change positive">+5.2%</div>
                    </div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-icon">⚠️</div>
                    <div class="kpi-content">
                        <div class="kpi-value">12</div>
                        <div class="kpi-label">Low Stock Items</div>
                        <div class="kpi-change negative">+3</div>
                    </div>
                </div>
            </div>

            <div class="dashboard-grid">
                <div class="chart-card">
                    <h3>Sales Trend</h3>
                    <div class="chart-container" style="position: relative; height: 300px;">
                        <canvas id="salesChart"></canvas>
                    </div>
                </div>

                <div class="insights-panel">
                    <h3>AI Insights & Alerts</h3>
                    <div class="insights-list" id="dashboardInsights">
                        <!-- Insights will be populated by JavaScript -->
                    </div>
                    <button class="btn btn--outline btn--sm" onclick="showModule('insights')">View All Insights</button>
                </div>

                <div class="activity-feed">
                    <h3>Recent Activity</h3>
                    <div class="activity-list">
                        <div class="activity-item">
                            <div class="activity-icon">📋</div>
                            <div class="activity-content">
                                <div class="activity-text">New order from ABC Construction Co</div>
                                <div class="activity-time">2 hours ago</div>
                            </div>
                        </div>
                        <div class="activity-item">
                            <div class="activity-icon">⚠️</div>
                            <div class="activity-content">
                                <div class="activity-text">Low stock alert: Portland Cement</div>
                                <div class="activity-time">4 hours ago</div>
                            </div>
                        </div>
                        <div class="activity-item">
                            <div class="activity-icon">✅</div>
                            <div class="activity-content">
                                <div class="activity-text">Order ORD003 delivered to Home Depot</div>
                                <div class="activity-time">6 hours ago</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Inventory Module -->
        <div id="inventory" class="module">
            <div class="module-header">
                <h2>Inventory Management</h2>
            <div class="module-actions">
                <input type="text" class="form-control search-input" placeholder="Search products..." id="productSearch">
                <button class="btn btn--primary" id="addProductBtn">+ Add Product</button>
                <button class="btn btn--secondary" id="uploadCSVBtn">📁 Upload CSV</button>
                <button class="btn btn--outline" id="exportInventoryBtn">Export PDF</button>
            </div>
            
            <!-- CSV Upload Section (initially hidden) -->
            <div class="csv-upload-section" id="csvUploadSection" style="display: none;">
                <div class="upload-container">
                    <div class="upload-header">
                        <h4>📊 Import Inventory from CSV</h4>
                        <button class="btn btn--sm btn--outline" id="cancelUploadBtn">✕ Cancel</button>
                    </div>
                    <div class="upload-body">
                        <div class="file-drop-zone" id="fileDropZone">
                            <div class="drop-zone-content">
                                <span class="drop-icon">📄</span>
                                <p>Drag and drop your CSV file here, or <span class="browse-link" id="browseLink">browse to select</span></p>
                                <input type="file" id="csvFileInput" accept=".csv" style="display: none;">
                                <div class="file-requirements">
                                    <small>Supported: CSV files with product data (SKU, Name, Category, Price, Stock, etc.)</small>
                                </div>
                            </div>
                        </div>
                        <div class="upload-progress" id="uploadProgress" style="display: none;">
                            <div class="progress-bar">
                                <div class="progress-fill" id="progressFill"></div>
                            </div>
                            <div class="progress-text" id="progressText">Processing...</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- CSV Preview Modal (will be shown after processing) -->
            <div class="csv-preview-modal" id="csvPreviewModal" style="display: none;">
                <div class="modal-backdrop"></div>
                <div class="preview-content">
                    <div class="preview-header">
                        <h3>🤖 AI-Processed CSV Data Preview</h3>
                        <button class="btn btn--sm btn--outline" id="cancelPreviewBtn">✕ Cancel</button>
                    </div>
                    <div class="preview-body">
                        <div class="ai-analysis" id="aiAnalysis">
                            <!-- AI analysis results will be populated here -->
                        </div>
                        <div class="preview-table-container">
                            <table class="preview-table" id="previewTable">
                                <!-- Parsed data preview will be populated here -->
                            </table>
                        </div>
                    </div>
                    <div class="preview-footer">
                        <div class="import-summary" id="importSummary"></div>
                        <div class="preview-actions">
                            <button class="btn btn--outline" id="cancelImportBtn">Cancel</button>
                            <button class="btn btn--primary" id="confirmImportBtn">✓ Import Products</button>
                        </div>
                    </div>
                </div>
            </div>
            </div>

            <div class="filter-bar">
                <select class="form-control" id="categoryFilter">
                    <option value="">All Categories</option>
                    <option value="Lumber">Lumber</option>
                    <option value="Concrete">Concrete</option>
                    <option value="Roofing">Roofing</option>
                    <option value="Electrical">Electrical</option>
                    <option value="Plumbing">Plumbing</option>
                    <option value="Insulation">Insulation</option>
                    <option value="Drywall">Drywall</option>
                    <option value="Flooring">Flooring</option>
                </select>
                <select class="form-control" id="stockFilter">
                    <option value="">All Stock Levels</option>
                    <option value="low">Low Stock</option>
                    <option value="normal">Normal Stock</option>
                    <option value="high">High Stock</option>
                </select>
            </div>

            <div class="inventory-stats">
                <div class="stat-item">
                    <span class="stat-value">8</span>
                    <span class="stat-label">Total Products</span>
                </div>
                <div class="stat-item">
                    <span class="stat-value">$67,432</span>
                    <span class="stat-label">Total Inventory Value</span>
                </div>
                <div class="stat-item">
                    <span class="stat-value">4.2</span>
                    <span class="stat-label">Avg Turnover Rate</span>
                </div>
            </div>

            <div class="table-container">
                <table class="data-table" id="productTable">
                    <thead>
                        <tr>
                            <th>SKU</th>
                            <th>Product Name</th>
                            <th>Category</th>
                            <th>Stock Level</th>
                            <th>Price</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="productTableBody">
                        <!-- Product rows will be populated by JavaScript -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Customers Module -->
        <div id="customers" class="module">
            <div class="module-header">
                <h2>Customer Management</h2>
                <div class="module-actions">
                    <input type="text" class="form-control search-input" placeholder="Search customers..." id="customerSearch">
                    <button class="btn btn--primary" id="addCustomerBtn">+ Add Customer</button>
                    <button class="btn btn--secondary" id="uploadCustomerCSVBtn">📁 Upload CSV</button>
                    <button class="btn btn--outline" id="exportCustomersBtn">Export PDF</button>
                </div>
            </div>
            
            <!-- Customer CSV Upload Section (initially hidden) -->
            <div class="csv-upload-section" id="customerCSVUploadSection" style="display: none;">
                <div class="upload-container">
                    <div class="upload-header">
                        <h4>👥 Import Customers from CSV</h4>
                        <button class="btn btn--sm btn--outline" id="cancelCustomerUploadBtn">✕ Cancel</button>
                    </div>
                    <div class="upload-body">
                        <div class="file-drop-zone" id="customerFileDropZone">
                            <div class="drop-zone-content">
                                <span class="drop-icon">📄</span>
                                <p>Drag and drop your customer CSV file here, or <span class="browse-link" id="customerBrowseLink">browse to select</span></p>
                                <input type="file" id="customerCSVFileInput" accept=".csv" style="display: none;">
                                <div class="file-requirements">
                                    <small>Supported: CSV files with customer data (Name, Type, Contact, Revenue, etc.)</small>
                                </div>
                            </div>
                        </div>
                        <div class="upload-progress" id="customerUploadProgress" style="display: none;">
                            <div class="progress-bar">
                                <div class="progress-fill" id="customerProgressFill"></div>
                            </div>
                            <div class="progress-text" id="customerProgressText">Processing...</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Customer CSV Preview Modal -->
            <div class="csv-preview-modal" id="customerCSVPreviewModal" style="display: none;">
                <div class="modal-backdrop"></div>
                <div class="preview-content">
                    <div class="preview-header">
                        <h3>🤖 AI-Processed Customer CSV Preview</h3>
                        <button class="btn btn--sm btn--outline" id="cancelCustomerPreviewBtn">✕ Cancel</button>
                    </div>
                    <div class="preview-body">
                        <div class="ai-analysis" id="customerAIAnalysis">
                            <!-- AI analysis results will be populated here -->
                        </div>
                        <div class="preview-table-container">
                            <table class="preview-table" id="customerPreviewTable">
                                <!-- Parsed data preview will be populated here -->
                            </table>
                        </div>
                    </div>
                    <div class="preview-footer">
                        <div class="import-summary" id="customerImportSummary"></div>
                        <div class="preview-actions">
                            <button class="btn btn--outline" id="cancelCustomerImportBtn">Cancel</button>
                            <button class="btn btn--primary" id="confirmCustomerImportBtn">✓ Import Customers</button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="customer-segments">
                <div class="segment-card">
                    <h4>General Contractors</h4>
                    <div class="segment-count">15</div>
                    <div class="segment-revenue">$342K Revenue</div>
                </div>
                <div class="segment-card">
                    <h4>Trade Contractors</h4>
                    <div class="segment-count">42</div>
                    <div class="segment-revenue">$189K Revenue</div>
                </div>
                <div class="segment-card">
                    <h4>Retailers</h4>
                    <div class="segment-count">8</div>
                    <div class="segment-revenue">$156K Revenue</div>
                </div>
            </div>

            <div class="table-container">
                <table class="data-table" id="customerTable">
                    <thead>
                        <tr>
                            <th>Customer Name</th>
                            <th>Type</th>
                            <th>Revenue</th>
                            <th>Orders</th>
                            <th>Churn Risk</th>
                            <th>Last Order</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="customerTableBody">
                        <!-- Customer rows will be populated by JavaScript -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Orders Module -->
        <div id="orders" class="module">
            <div class="module-header">
                <h2>Sales & Orders</h2>
                <div class="module-actions">
                    <button class="btn btn--primary" id="newOrderBtn">+ New Order</button>
                    <button class="btn btn--outline" id="exportOrdersBtn">Export PDF</button>
                </div>
            </div>

            <div class="order-pipeline">
                <div class="pipeline-stage">
                    <h4>Quotes</h4>
                    <div class="stage-count">23</div>
                    <div class="stage-value">$45,678</div>
                </div>
                <div class="pipeline-stage">
                    <h4>Processing</h4>
                    <div class="stage-count">12</div>
                    <div class="stage-value">$28,934</div>
                </div>
                <div class="pipeline-stage">
                    <h4>Shipped</h4>
                    <div class="stage-count">34</div>
                    <div class="stage-value">$67,234</div>
                </div>
                <div class="pipeline-stage">
                    <h4>Delivered</h4>
                    <div class="stage-count">87</div>
                    <div class="stage-value">$134,567</div>
                </div>
            </div>

            <div class="table-container">
                <table class="data-table" id="orderTable">
                    <thead>
                        <tr>
                            <th>Order ID</th>
                            <th>Customer</th>
                            <th>Date</th>
                            <th>Total</th>
                            <th>Status</th>
                            <th>Items</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="orderTableBody">
                        <!-- Order rows will be populated by JavaScript -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- AI Insights Module -->
        <div id="insights" class="module">
            <div class="module-header">
                <h2>🧠 AI Insights Hub</h2>
                <div class="module-actions">
                    <button class="btn btn--outline" id="refreshInsightsBtn">🔄 Refresh</button>
                    <button class="btn btn--secondary" id="aiConfigBtn">⚙️ AI Settings</button>
                </div>
            </div>

            <!-- AI Query Interface -->
            <div class="ai-query-section">
                <div class="query-card">
                    <div class="query-header">
                        <h3>🤖 Ask Your Business AI</h3>
                        <div class="query-status" id="queryStatus">
                            <span class="status-indicator ready"></span>
                            <span class="status-text">Ready to help</span>
                        </div>
                    </div>
                    
                    <div class="query-input-container">
                        <div class="query-input-wrapper">
                            <input type="text" 
                                   id="aiQueryInput" 
                                   class="ai-query-input" 
                                   placeholder="Ask anything... 'Show sales trends', 'Check low stock', 'Analyze customer churn'"
                                   autocomplete="off">
                            <button class="query-send-btn" id="sendQueryBtn">
                                <span class="send-icon">🚀</span>
                            </button>
                        </div>
                        <div class="query-suggestions">
                            <span class="suggestion-label">Try asking:</span>
                            <button class="query-suggestion" data-query="show sales trends for this month">📈 Sales trends</button>
                            <button class="query-suggestion" data-query="check inventory low stock alerts">📦 Low stock alerts</button>
                            <button class="query-suggestion" data-query="analyze customer churn risk">👥 Customer churn</button>
                            <button class="query-suggestion" data-query="forecast inventory demand">🔮 Demand forecast</button>
                        </div>
                    </div>

                    <div class="query-response" id="queryResponse" style="display: none;">
                        <div class="response-header">
                            <h4 class="response-title" id="responseTitle"></h4>
                            <span class="response-timestamp" id="responseTimestamp"></span>
                        </div>
                        <div class="response-content" id="responseContent"></div>
                        <div class="response-actions" id="responseActions" style="display: none;"></div>
                    </div>
                </div>
            </div>

            <!-- AI Insights Grid -->
            <div class="insights-grid">
                <div class="insight-category">
                    <div class="category-header">
                        <h3>🚨 Critical Alerts</h3>
                        <span class="alert-count" id="criticalCount">0</span>
                    </div>
                    <div class="insight-list" id="criticalInsights">
                        <div class="insight-placeholder">
                            <div class="placeholder-icon">🔄</div>
                            <p>Loading critical alerts...</p>
                        </div>
                    </div>
                </div>
                
                <div class="insight-category">
                    <div class="category-header">
                        <h3>⚠️ Warnings</h3>
                        <span class="alert-count" id="warningCount">0</span>
                    </div>
                    <div class="insight-list" id="warningInsights">
                        <div class="insight-placeholder">
                            <div class="placeholder-icon">🔄</div>
                            <p>Loading warnings...</p>
                        </div>
                    </div>
                </div>
                
                <div class="insight-category">
                    <div class="category-header">
                        <h3>💡 Recommendations</h3>
                        <span class="alert-count" id="recommendationCount">0</span>
                    </div>
                    <div class="insight-list" id="infoInsights">
                        <div class="insight-placeholder">
                            <div class="placeholder-icon">🔄</div>
                            <p>Loading recommendations...</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- AI Analytics Dashboard -->
            <div class="ai-analytics-section">
                <div class="analytics-tabs">
                    <button class="analytics-tab active" data-tab="forecasts">📊 Forecasts</button>
                    <button class="analytics-tab" data-tab="trends">📈 Trends</button>
                    <button class="analytics-tab" data-tab="patterns">🔍 Patterns</button>
                </div>

                <div class="analytics-content">
                    <!-- Forecasts Tab -->
                    <div class="analytics-tab-content active" id="forecastsTab">
                        <div class="forecast-grid">
                            <div class="forecast-card">
                                <h4>Sales Forecast</h4>
                                <div class="chart-container" style="position: relative; height: 250px;">
                                    <canvas id="salesForecastChart"></canvas>
                                </div>
                                <div class="forecast-summary" id="salesForecastSummary">
                                    <div class="loading-spinner">Loading forecast...</div>
                                </div>
                            </div>
                            
                            <div class="forecast-card">
                                <h4>Inventory Demand</h4>
                                <div class="chart-container" style="position: relative; height: 250px;">
                                    <canvas id="demandForecastChart"></canvas>
                                </div>
                                <div class="forecast-summary" id="demandForecastSummary">
                                    <div class="loading-spinner">Loading forecast...</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Trends Tab -->
                    <div class="analytics-tab-content" id="trendsTab">
                        <div class="trends-grid">
                            <div class="trend-card">
                                <h4>Customer Behavior Trends</h4>
                                <div class="chart-container" style="position: relative; height: 250px;">
                                    <canvas id="customerTrendChart"></canvas>
                                </div>
                            </div>
                            
                            <div class="trend-card">
                                <h4>Product Performance</h4>
                                <div class="chart-container" style="position: relative; height: 250px;">
                                    <canvas id="productTrendChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Patterns Tab -->
                    <div class="analytics-tab-content" id="patternsTab">
                        <div class="patterns-grid">
                            <div class="pattern-card">
                                <h4>🎯 Key Patterns Detected</h4>
                                <div class="pattern-list" id="detectedPatterns">
                                    <div class="loading-spinner">Analyzing patterns...</div>
                                </div>
                            </div>
                            
                            <div class="pattern-card">
                                <h4>📊 Business Insights</h4>
                                <div class="insight-metrics" id="businessInsights">
                                    <div class="loading-spinner">Generating insights...</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Financial Management Module -->
        <div id="financial" class="module">
            <div class="module-header">
                <h2>Financial Management</h2>
                <div class="module-actions">
                    <select class="form-control" id="financialPeriod">
                        <option value="current">Current Month</option>
                        <option value="quarter">Current Quarter</option>
                        <option value="year">Current Year</option>
                    </select>
                    <button class="btn btn--outline" id="exportFinancialBtn">Export Reports</button>
                </div>
            </div>

            <!-- Financial Sub-navigation -->
            <div class="financial-nav">
                <div class="tab-nav">
                    <button class="tab-btn active" data-tab="overview">📊 Overview</button>
                    <button class="tab-btn" data-tab="general-ledger">📚 General Ledger</button>
                    <button class="tab-btn" data-tab="ap">📤 Accounts Payable</button>
                    <button class="tab-btn" data-tab="ar">📥 Accounts Receivable</button>
                    <button class="tab-btn" data-tab="cashflow">💳 Cash Flow</button>
                    <button class="tab-btn" data-tab="reports">📈 Reports</button>
                </div>
            </div>

            <!-- Financial Overview Tab -->
            <div class="financial-tab active" id="overview">
                <div class="financial-kpi-grid">
                    <div class="kpi-card">
                        <div class="kpi-icon">💰</div>
                        <div class="kpi-content">
                            <div class="kpi-value">$1,234,567</div>
                            <div class="kpi-label">Total Revenue</div>
                            <div class="kpi-change positive">+15.3%</div>
                        </div>
                    </div>
                    <div class="kpi-card">
                        <div class="kpi-icon">📊</div>
                        <div class="kpi-content">
                            <div class="kpi-value">$234,890</div>
                            <div class="kpi-label">Net Profit</div>
                            <div class="kpi-change positive">+8.7%</div>
                        </div>
                    </div>
                    <div class="kpi-card">
                        <div class="kpi-icon">💳</div>
                        <div class="kpi-content">
                            <div class="kpi-value">$456,789</div>
                            <div class="kpi-label">Cash Balance</div>
                            <div class="kpi-change negative">-2.1%</div>
                        </div>
                    </div>
                    <div class="kpi-card">
                        <div class="kpi-icon">📋</div>
                        <div class="kpi-content">
                            <div class="kpi-value">$89,456</div>
                            <div class="kpi-label">Outstanding AR</div>
                            <div class="kpi-change positive">-5.2%</div>
                        </div>
                    </div>
                </div>

                <div class="financial-dashboard-grid">
                    <div class="chart-card">
                        <h3>Cash Flow Trend</h3>
                        <div class="chart-container" style="position: relative; height: 300px;">
                            <canvas id="cashFlowChart"></canvas>
                        </div>
                    </div>
                    <div class="financial-alerts">
                        <h3>Financial Alerts</h3>
                        <div class="alert-list" id="financialAlerts">
                            <!-- Financial alerts populated by JS -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- General Ledger Tab -->
            <div class="financial-tab" id="general-ledger" style="display: none;">
                <div class="gl-header">
                    <h3>General Ledger</h3>
                    <div class="gl-actions">
                        <button class="btn btn--primary" id="newJournalEntryBtn">+ New Journal Entry</button>
                        <button class="btn btn--secondary" id="importGLBtn">📁 Import</button>
                        <button class="btn btn--outline" id="exportGLBtn">Export GL</button>
                    </div>
                </div>

                <!-- Chart of Accounts Section -->
                <div class="gl-section">
                    <div class="section-header">
                        <h4>Chart of Accounts</h4>
                        <button class="btn btn--sm btn--outline" id="addAccountBtn">+ Add Account</button>
                    </div>
                    <div class="accounts-grid">
                        <div class="account-category">
                            <h5>💰 Assets</h5>
                            <div class="account-list">
                                <div class="account-item">
                                    <span class="account-code">1000</span>
                                    <span class="account-name">Cash - Operating</span>
                                    <span class="account-balance">$456,789.00</span>
                                </div>
                                <div class="account-item">
                                    <span class="account-code">1100</span>
                                    <span class="account-name">Accounts Receivable</span>
                                    <span class="account-balance">$89,456.00</span>
                                </div>
                                <div class="account-item">
                                    <span class="account-code">1200</span>
                                    <span class="account-name">Inventory</span>
                                    <span class="account-balance">$234,567.00</span>
                                </div>
                            </div>
                        </div>
                        <div class="account-category">
                            <h5>📋 Liabilities</h5>
                            <div class="account-list">
                                <div class="account-item">
                                    <span class="account-code">2000</span>
                                    <span class="account-name">Accounts Payable</span>
                                    <span class="account-balance">$67,890.00</span>
                                </div>
                                <div class="account-item">
                                    <span class="account-code">2100</span>
                                    <span class="account-name">Short-term Loans</span>
                                    <span class="account-balance">$125,000.00</span>
                                </div>
                            </div>
                        </div>
                        <div class="account-category">
                            <h5>📈 Revenue</h5>
                            <div class="account-list">
                                <div class="account-item">
                                    <span class="account-code">4000</span>
                                    <span class="account-name">Sales Revenue</span>
                                    <span class="account-balance">$1,234,567.00</span>
                                </div>
                            </div>
                        </div>
                        <div class="account-category">
                            <h5>💸 Expenses</h5>
                            <div class="account-list">
                                <div class="account-item">
                                    <span class="account-code">5000</span>
                                    <span class="account-name">Cost of Goods Sold</span>
                                    <span class="account-balance">$789,123.00</span>
                                </div>
                                <div class="account-item">
                                    <span class="account-code">5100</span>
                                    <span class="account-name">Operating Expenses</span>
                                    <span class="account-balance">$156,789.00</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Recent Journal Entries -->
                <div class="gl-section">
                    <div class="section-header">
                        <h4>Recent Journal Entries</h4>
                        <div class="section-actions">
                            <input type="text" class="form-control search-input" placeholder="Search entries..." id="journalSearch">
                            <select class="form-control" id="journalFilter">
                                <option value="">All Entries</option>
                                <option value="posted">Posted</option>
                                <option value="draft">Draft</option>
                                <option value="pending">Pending Approval</option>
                            </select>
                        </div>
                    </div>
                    <div class="table-container">
                        <table class="data-table" id="journalTable">
                            <thead>
                                <tr>
                                    <th>Entry #</th>
                                    <th>Date</th>
                                    <th>Description</th>
                                    <th>Debit</th>
                                    <th>Credit</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="journalTableBody">
                                <!-- Journal entries populated by JS -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <!-- Accounts Payable Tab -->
            <div class="financial-tab" id="ap" style="display: none;">
                <div class="ap-header">
                    <h3>Accounts Payable</h3>
                    <div class="ap-actions">
                        <button class="btn btn--primary" id="newBillBtn">+ New Bill</button>
                        <button class="btn btn--secondary" id="recordPaymentBtn">💳 Record Payment</button>
                        <button class="btn btn--outline" id="exportAPBtn">Export AP</button>
                    </div>
                </div>

                <!-- AP Summary Cards -->
                <div class="ap-summary-grid">
                    <div class="summary-card">
                        <div class="summary-icon">💰</div>
                        <div class="summary-content">
                            <div class="summary-value">$67,890</div>
                            <div class="summary-label">Total Outstanding</div>
                        </div>
                    </div>
                    <div class="summary-card">
                        <div class="summary-icon">🕰️</div>
                        <div class="summary-content">
                            <div class="summary-value">$23,456</div>
                            <div class="summary-label">Overdue</div>
                        </div>
                    </div>
                    <div class="summary-card">
                        <div class="summary-icon">📅</div>
                        <div class="summary-content">
                            <div class="summary-value">$12,345</div>
                            <div class="summary-label">Due This Week</div>
                        </div>
                    </div>
                    <div class="summary-card">
                        <div class="summary-icon">🏦</div>
                        <div class="summary-content">
                            <div class="summary-value">42</div>
                            <div class="summary-label">Active Vendors</div>
                        </div>
                    </div>
                </div>

                <!-- Vendor Management Section -->
                <div class="ap-section">
                    <div class="section-header">
                        <h4>Vendor Management</h4>
                        <div class="section-actions">
                            <input type="text" class="form-control search-input" placeholder="Search vendors..." id="vendorSearch">
                            <button class="btn btn--sm btn--outline" id="addVendorBtn">+ Add Vendor</button>
                        </div>
                    </div>
                    <div class="vendor-grid">
                        <div class="vendor-card">
                            <div class="vendor-info">
                                <h5>ABC Supplies Inc.</h5>
                                <p>Construction Materials</p>
                                <span class="vendor-status active">Active</span>
                            </div>
                            <div class="vendor-stats">
                                <div class="stat">
                                    <span class="stat-value">$15,234</span>
                                    <span class="stat-label">Outstanding</span>
                                </div>
                                <div class="stat">
                                    <span class="stat-value">Net 30</span>
                                    <span class="stat-label">Terms</span>
                                </div>
                            </div>
                        </div>
                        <div class="vendor-card">
                            <div class="vendor-info">
                                <h5>Steel Solutions LLC</h5>
                                <p>Metal & Steel Products</p>
                                <span class="vendor-status active">Active</span>
                            </div>
                            <div class="vendor-stats">
                                <div class="stat">
                                    <span class="stat-value">$8,976</span>
                                    <span class="stat-label">Outstanding</span>
                                </div>
                                <div class="stat">
                                    <span class="stat-value">Net 15</span>
                                    <span class="stat-label">Terms</span>
                                </div>
                            </div>
                        </div>
                        <div class="vendor-card">
                            <div class="vendor-info">
                                <h5>Concrete Co.</h5>
                                <p>Concrete & Cement</p>
                                <span class="vendor-status warning">Overdue</span>
                            </div>
                            <div class="vendor-stats">
                                <div class="stat">
                                    <span class="stat-value">$23,456</span>
                                    <span class="stat-label">Overdue</span>
                                </div>
                                <div class="stat">
                                    <span class="stat-value">Net 30</span>
                                    <span class="stat-label">Terms</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Outstanding Bills -->
                <div class="ap-section">
                    <div class="section-header">
                        <h4>Outstanding Bills</h4>
                        <div class="section-actions">
                            <select class="form-control" id="billFilter">
                                <option value="">All Bills</option>
                                <option value="overdue">Overdue</option>
                                <option value="due-soon">Due This Week</option>
                                <option value="scheduled">Scheduled Payments</option>
                            </select>
                        </div>
                    </div>
                    <div class="table-container">
                        <table class="data-table" id="billsTable">
                            <thead>
                                <tr>
                                    <th>Bill #</th>
                                    <th>Vendor</th>
                                    <th>Date</th>
                                    <th>Due Date</th>
                                    <th>Amount</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="billsTableBody">
                                <!-- Bills populated by JS -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Payment Processing -->
                <div class="ap-section">
                    <div class="section-header">
                        <h4>Automated Invoice Processing</h4>
                        <button class="btn btn--sm btn--primary" id="uploadInvoiceBtn">📄 Upload Invoice</button>
                    </div>
                    <div class="invoice-processing">
                        <div class="processing-stats">
                            <div class="processing-stat">
                                <span class="stat-number">156</span>
                                <span class="stat-description">Invoices Processed This Month</span>
                            </div>
                            <div class="processing-stat">
                                <span class="stat-number">98.5%</span>
                                <span class="stat-description">Auto-Processing Accuracy</span>
                            </div>
                            <div class="processing-stat">
                                <span class="stat-number">12</span>
                                <span class="stat-description">Pending Manual Review</span>
                            </div>
                        </div>
                        <div class="approval-workflow">
                            <h5>Approval Workflow</h5>
                            <div class="workflow-steps">
                                <div class="workflow-step completed">
                                    <div class="step-icon">✓</div>
                                    <div class="step-info">
                                        <span class="step-title">AI Processing</span>
                                        <span class="step-description">Data extraction & validation</span>
                                    </div>
                                </div>
                                <div class="workflow-step active">
                                    <div class="step-icon">2</div>
                                    <div class="step-info">
                                        <span class="step-title">Manager Review</span>
                                        <span class="step-description">3 items pending</span>
                                    </div>
                                </div>
                                <div class="workflow-step">
                                    <div class="step-icon">3</div>
                                    <div class="step-info">
                                        <span class="step-title">Payment Authorization</span>
                                        <span class="step-description">Final approval</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Accounts Receivable Tab -->
            <div class="financial-tab" id="ar" style="display: none;">
                <div class="ar-header">
                    <h3>Accounts Receivable</h3>
                    <div class="ar-actions">
                        <button class="btn btn--primary" id="newInvoiceBtn">+ New Invoice</button>
                        <button class="btn btn--secondary" id="recordARPaymentBtn">💳 Record Payment</button>
                        <button class="btn btn--outline" id="exportARBtn">Export AR</button>
                    </div>
                </div>

                <!-- AR Summary Cards -->
                <div class="ar-summary-grid">
                    <div class="summary-card">
                        <div class="summary-icon">💰</div>
                        <div class="summary-content">
                            <div class="summary-value">$89,456</div>
                            <div class="summary-label">Total Outstanding</div>
                        </div>
                    </div>
                    <div class="summary-card">
                        <div class="summary-icon">🕰️</div>
                        <div class="summary-content">
                            <div class="summary-value">$34,567</div>
                            <div class="summary-label">Overdue</div>
                        </div>
                    </div>
                    <div class="summary-card">
                        <div class="summary-icon">📅</div>
                        <div class="summary-content">
                            <div class="summary-value">15.2</div>
                            <div class="summary-label">Avg Collection Days</div>
                        </div>
                    </div>
                    <div class="summary-card">
                        <div class="summary-icon">🎯</div>
                        <div class="summary-content">
                            <div class="summary-value">96.8%</div>
                            <div class="summary-label">Collection Rate</div>
                        </div>
                    </div>
                </div>

                <!-- Customer Aging Report -->
                <div class="ar-section">
                    <div class="section-header">
                        <h4>Customer Aging Analysis</h4>
                        <div class="section-actions">
                            <select class="form-control" id="agingFilter">
                                <option value="">All Customers</option>
                                <option value="current">Current (0-30 days)</option>
                                <option value="overdue-30">31-60 days</option>
                                <option value="overdue-60">61-90 days</option>
                                <option value="overdue-90">90+ days</option>
                            </select>
                        </div>
                    </div>
                    <div class="aging-chart">
                        <div class="aging-bucket">
                            <div class="bucket-header">Current (0-30)</div>
                            <div class="bucket-amount">$45,678</div>
                            <div class="bucket-percentage">51%</div>
                        </div>
                        <div class="aging-bucket warning">
                            <div class="bucket-header">31-60 days</div>
                            <div class="bucket-amount">$23,456</div>
                            <div class="bucket-percentage">26%</div>
                        </div>
                        <div class="aging-bucket danger">
                            <div class="bucket-header">61-90 days</div>
                            <div class="bucket-amount">$12,345</div>
                            <div class="bucket-percentage">14%</div>
                        </div>
                        <div class="aging-bucket critical">
                            <div class="bucket-header">90+ days</div>
                            <div class="bucket-amount">$7,977</div>
                            <div class="bucket-percentage">9%</div>
                        </div>
                    </div>
                </div>

                <!-- Outstanding Invoices -->
                <div class="ar-section">
                    <div class="section-header">
                        <h4>Outstanding Invoices</h4>
                        <div class="section-actions">
                            <input type="text" class="form-control search-input" placeholder="Search invoices..." id="invoiceSearch">
                            <select class="form-control" id="invoiceFilter">
                                <option value="">All Invoices</option>
                                <option value="overdue">Overdue</option>
                                <option value="due-soon">Due This Week</option>
                                <option value="paid">Recently Paid</option>
                            </select>
                        </div>
                    </div>
                    <div class="table-container">
                        <table class="data-table" id="invoicesTable">
                            <thead>
                                <tr>
                                    <th>Invoice #</th>
                                    <th>Customer</th>
                                    <th>Date</th>
                                    <th>Due Date</th>
                                    <th>Amount</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="invoicesTableBody">
                                <!-- Invoices populated by JS -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Collection Management -->
                <div class="ar-section">
                    <div class="section-header">
                        <h4>Collection Management</h4>
                    </div>
                    <div class="collection-dashboard">
                        <div class="collection-stats">
                            <div class="collection-stat">
                                <span class="stat-number">23</span>
                                <span class="stat-description">Active Collection Cases</span>
                            </div>
                            <div class="collection-stat">
                                <span class="stat-number">$45,678</span>
                                <span class="stat-description">Amount in Collections</span>
                            </div>
                            <div class="collection-stat">
                                <span class="stat-number">7</span>
                                <span class="stat-description">Payment Plans Active</span>
                            </div>
                        </div>
                        <div class="collection-actions">
                            <button class="btn btn--outline" id="sendRemindersBtn">✉️ Send Reminders</button>
                            <button class="btn btn--outline" id="generateStatementsBtn">📄 Generate Statements</button>
                            <button class="btn btn--outline" id="setupPaymentPlanBtn">📅 Setup Payment Plan</button>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Cash Flow Tab -->
            <div class="financial-tab" id="cashflow" style="display: none;">
                <div class="cashflow-header">
                    <h3>Cash Flow & Bank Reconciliation</h3>
                    <div class="cashflow-actions">
                        <button class="btn btn--primary" id="reconcileBankBtn">🏦 Bank Reconciliation</button>
                        <button class="btn btn--secondary" id="importBankStmtBtn">📄 Import Statement</button>
                        <button class="btn btn--outline" id="exportCashFlowBtn">Export Reports</button>
                    </div>
                </div>

                <!-- Cash Flow Summary -->
                <div class="cashflow-summary">
                    <div class="summary-card">
                        <div class="summary-icon">💰</div>
                        <div class="summary-content">
                            <div class="summary-value">$456,789</div>
                            <div class="summary-label">Current Cash Balance</div>
                        </div>
                    </div>
                    <div class="summary-card">
                        <div class="summary-icon">📈</div>
                        <div class="summary-content">
                            <div class="summary-value">$67,234</div>
                            <div class="summary-label">Monthly Inflow</div>
                        </div>
                    </div>
                    <div class="summary-card">
                        <div class="summary-icon">📉</div>
                        <div class="summary-content">
                            <div class="summary-value">$45,123</div>
                            <div class="summary-label">Monthly Outflow</div>
                        </div>
                    </div>
                    <div class="summary-card">
                        <div class="summary-icon">🔮</div>
                        <div class="summary-content">
                            <div class="summary-value">$234,567</div>
                            <div class="summary-label">30-Day Forecast</div>
                        </div>
                    </div>
                </div>

                <!-- Cash Flow Chart -->
                <div class="cashflow-section">
                    <div class="section-header">
                        <h4>Cash Flow Forecast (Next 12 Months)</h4>
                        <div class="section-actions">
                            <select class="form-control" id="forecastPeriod">
                                <option value="3">3 Months</option>
                                <option value="6">6 Months</option>
                                <option value="12" selected>12 Months</option>
                            </select>
                        </div>
                    </div>
                    <div class="chart-card">
                        <div class="chart-container" style="position: relative; height: 350px;">
                            <canvas id="cashFlowForecastChart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Bank Accounts -->
                <div class="cashflow-section">
                    <div class="section-header">
                        <h4>Bank Accounts</h4>
                        <button class="btn btn--sm btn--outline" id="addBankAccountBtn">+ Add Account</button>
                    </div>
                    <div class="bank-accounts-grid">
                        <div class="bank-account-card">
                            <div class="bank-info">
                                <h5>🏦 Chase Business Checking</h5>
                                <p>Account: ****1234</p>
                                <span class="account-status reconciled">Reconciled</span>
                            </div>
                            <div class="bank-balance">
                                <div class="balance-amount">$324,567.89</div>
                                <div class="balance-label">Available Balance</div>
                                <div class="last-reconciled">Last reconciled: 2 days ago</div>
                            </div>
                        </div>
                        <div class="bank-account-card">
                            <div class="bank-info">
                                <h5>🏦 Wells Fargo Savings</h5>
                                <p>Account: ****5678</p>
                                <span class="account-status pending">Pending Reconciliation</span>
                            </div>
                            <div class="bank-balance">
                                <div class="balance-amount">$132,221.11</div>
                                <div class="balance-label">Available Balance</div>
                                <div class="last-reconciled">Last reconciled: 5 days ago</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Recent Transactions -->
                <div class="cashflow-section">
                    <div class="section-header">
                        <h4>Recent Bank Transactions</h4>
                        <div class="section-actions">
                            <select class="form-control" id="bankAccountFilter">
                                <option value="">All Accounts</option>
                                <option value="checking">Business Checking</option>
                                <option value="savings">Business Savings</option>
                            </select>
                            <select class="form-control" id="transactionFilter">
                                <option value="">All Transactions</option>
                                <option value="unmatched">Unmatched</option>
                                <option value="matched">Matched</option>
                                <option value="pending">Pending</option>
                            </select>
                        </div>
                    </div>
                    <div class="table-container">
                        <table class="data-table" id="bankTransactionsTable">
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Description</th>
                                    <th>Account</th>
                                    <th>Amount</th>
                                    <th>Type</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="bankTransactionsTableBody">
                                <!-- Bank transactions populated by JS -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Multi-Currency Support -->
                <div class="cashflow-section">
                    <div class="section-header">
                        <h4>Multi-Currency Management</h4>
                        <button class="btn btn--sm btn--outline" id="updateExchangeRatesBtn">🔄 Update Rates</button>
                    </div>
                    <div class="currency-grid">
                        <div class="currency-card">
                            <div class="currency-info">
                                <h5>🇺🇸 USD (Base)</h5>
                                <div class="currency-rate">1.0000</div>
                            </div>
                            <div class="currency-balance">$456,789.00</div>
                        </div>
                        <div class="currency-card">
                            <div class="currency-info">
                                <h5>🇪🇺 EUR</h5>
                                <div class="currency-rate">0.8542</div>
                            </div>
                            <div class="currency-balance">€23,456.78</div>
                        </div>
                        <div class="currency-card">
                            <div class="currency-info">
                                <h5>🇨🇦 CAD</h5>
                                <div class="currency-rate">1.3245</div>
                            </div>
                            <div class="currency-balance">C$12,345.67</div>
                        </div>
                        <div class="currency-card">
                            <div class="currency-info">
                                <h5>🇬🇧 GBP</h5>
                                <div class="currency-rate">0.7834</div>
                            </div>
                            <div class="currency-balance">£8,976.54</div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Financial Reports Tab -->
            <div class="financial-tab" id="reports" style="display: none;">
                <div class="reports-header">
                    <h3>Financial Reports</h3>
                    <div class="reports-actions">
                        <select class="form-control" id="reportType">
                            <option value="pnl">Profit & Loss</option>
                            <option value="balance-sheet">Balance Sheet</option>
                            <option value="cashflow-stmt">Cash Flow Statement</option>
                            <option value="trial-balance">Trial Balance</option>
                        </select>
                        <select class="form-control" id="reportPeriodFinancial">
                            <option value="current-month">Current Month</option>
                            <option value="current-quarter">Current Quarter</option>
                            <option value="current-year">Current Year</option>
                            <option value="last-year">Last Year</option>
                        </select>
                        <button class="btn btn--outline" id="exportFinancialReportsBtn">Export All</button>
                    </div>
                </div>

                <!-- Financial Statements Grid -->
                <div class="financial-statements-grid">
                    <!-- Profit & Loss Statement -->
                    <div class="statement-card">
                        <div class="statement-header">
                            <h4>📈 Profit & Loss Statement</h4>
                            <span class="statement-period">Current Month</span>
                        </div>
                        <div class="statement-content">
                            <div class="statement-section">
                                <h5>Revenue</h5>
                                <div class="statement-line">
                                    <span class="line-item">Sales Revenue</span>
                                    <span class="line-amount">$234,567</span>
                                </div>
                                <div class="statement-line total">
                                    <span class="line-item">Total Revenue</span>
                                    <span class="line-amount">$234,567</span>
                                </div>
                            </div>
                            <div class="statement-section">
                                <h5>Cost of Goods Sold</h5>
                                <div class="statement-line">
                                    <span class="line-item">Materials Cost</span>
                                    <span class="line-amount">$145,234</span>
                                </div>
                                <div class="statement-line">
                                    <span class="line-item">Labor Cost</span>
                                    <span class="line-amount">$23,456</span>
                                </div>
                                <div class="statement-line total">
                                    <span class="line-item">Total COGS</span>
                                    <span class="line-amount">$168,690</span>
                                </div>
                            </div>
                            <div class="statement-section">
                                <h5>Operating Expenses</h5>
                                <div class="statement-line">
                                    <span class="line-item">Administrative</span>
                                    <span class="line-amount">$12,345</span>
                                </div>
                                <div class="statement-line">
                                    <span class="line-item">Sales & Marketing</span>
                                    <span class="line-amount">$8,976</span>
                                </div>
                                <div class="statement-line total">
                                    <span class="line-item">Total Operating Expenses</span>
                                    <span class="line-amount">$21,321</span>
                                </div>
                            </div>
                            <div class="statement-section net-income">
                                <div class="statement-line total">
                                    <span class="line-item">Net Income</span>
                                    <span class="line-amount positive">$44,556</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Balance Sheet -->
                    <div class="statement-card">
                        <div class="statement-header">
                            <h4>⚖️ Balance Sheet</h4>
                            <span class="statement-period">As of Current Date</span>
                        </div>
                        <div class="statement-content">
                            <div class="statement-section">
                                <h5>Assets</h5>
                                <div class="statement-line">
                                    <span class="line-item">Cash & Cash Equivalents</span>
                                    <span class="line-amount">$456,789</span>
                                </div>
                                <div class="statement-line">
                                    <span class="line-item">Accounts Receivable</span>
                                    <span class="line-amount">$89,456</span>
                                </div>
                                <div class="statement-line">
                                    <span class="line-item">Inventory</span>
                                    <span class="line-amount">$234,567</span>
                                </div>
                                <div class="statement-line total">
                                    <span class="line-item">Total Assets</span>
                                    <span class="line-amount">$780,812</span>
                                </div>
                            </div>
                            <div class="statement-section">
                                <h5>Liabilities</h5>
                                <div class="statement-line">
                                    <span class="line-item">Accounts Payable</span>
                                    <span class="line-amount">$67,890</span>
                                </div>
                                <div class="statement-line">
                                    <span class="line-item">Short-term Loans</span>
                                    <span class="line-amount">$125,000</span>
                                </div>
                                <div class="statement-line total">
                                    <span class="line-item">Total Liabilities</span>
                                    <span class="line-amount">$192,890</span>
                                </div>
                            </div>
                            <div class="statement-section">
                                <h5>Equity</h5>
                                <div class="statement-line">
                                    <span class="line-item">Owner's Equity</span>
                                    <span class="line-amount">$587,922</span>
                                </div>
                                <div class="statement-line total">
                                    <span class="line-item">Total Equity</span>
                                    <span class="line-amount">$587,922</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Financial Analytics Dashboard -->
                <div class="financial-analytics">
                    <div class="section-header">
                        <h4>Financial Analytics Dashboard</h4>
                    </div>
                    <div class="analytics-grid">
                        <div class="chart-card">
                            <h4>Revenue vs Expenses Trend</h4>
                            <div class="chart-container" style="position: relative; height: 300px;">
                                <canvas id="revenueExpenseChart"></canvas>
                            </div>
                        </div>
                        <div class="chart-card">
                            <h4>Profitability Analysis</h4>
                            <div class="chart-container" style="position: relative; height: 300px;">
                                <canvas id="profitabilityChart"></canvas>
                            </div>
                        </div>
                        <div class="chart-card">
                            <h4>Working Capital Trend</h4>
                            <div class="chart-container" style="position: relative; height: 300px;">
                                <canvas id="workingCapitalChart"></canvas>
                            </div>
                        </div>
                        <div class="chart-card">
                            <h4>Financial Ratios</h4>
                            <div class="ratios-grid">
                                <div class="ratio-item">
                                    <span class="ratio-label">Current Ratio</span>
                                    <span class="ratio-value">2.45</span>
                                </div>
                                <div class="ratio-item">
                                    <span class="ratio-label">Quick Ratio</span>
                                    <span class="ratio-value">1.87</span>
                                </div>
                                <div class="ratio-item">
                                    <span class="ratio-label">Debt-to-Equity</span>
                                    <span class="ratio-value">0.33</span>
                                </div>
                                <div class="ratio-item">
                                    <span class="ratio-label">Gross Margin</span>
                                    <span class="ratio-value">28.1%</span>
                                </div>
                                <div class="ratio-item">
                                    <span class="ratio-label">Net Margin</span>
                                    <span class="ratio-value">19.0%</span>
                                </div>
                                <div class="ratio-item">
                                    <span class="ratio-label">ROI</span>
                                    <span class="ratio-value">15.8%</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Budget vs Actual -->
                <div class="budget-section">
                    <div class="section-header">
                        <h4>Budget vs Actual Performance</h4>
                        <div class="section-actions">
                            <select class="form-control" id="budgetPeriod">
                                <option value="monthly">Monthly</option>
                                <option value="quarterly">Quarterly</option>
                                <option value="annual">Annual</option>
                            </select>
                        </div>
                    </div>
                    <div class="table-container">
                        <table class="data-table" id="budgetTable">
                            <thead>
                                <tr>
                                    <th>Category</th>
                                    <th>Budget</th>
                                    <th>Actual</th>
                                    <th>Variance</th>
                                    <th>Variance %</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody id="budgetTableBody">
                                <!-- Budget items populated by JS -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Supply Chain/Procurement Module -->
        <div id="supply-chain" class="module">
            <div class="module-header">
                <h2>Supply Chain & Procurement</h2>
                <div class="module-actions">
                    <select class="form-control" id="scPeriod">
                        <option value="current">Current Month</option>
                        <option value="quarter">Current Quarter</option>
                        <option value="year">Current Year</option>
                    </select>
                    <button class="btn btn--outline" id="exportSCBtn">Export Reports</button>
                </div>
            </div>

            <!-- Supply Chain Sub-navigation -->
            <div class="supply-chain-nav">
                <div class="tab-nav">
                    <button class="tab-btn active" data-tab="procurement">🛒 Procurement</button>
                    <button class="tab-btn" data-tab="inventory">📦 Inventory</button>
                    <button class="tab-btn" data-tab="logistics">🚚 Logistics</button>
                </div>
            </div>

            <!-- Procurement Tab -->
            <div class="supply-chain-tab active" id="procurement">
                <div class="procurement-header">
                    <h3>Procurement Management</h3>
                    <div class="procurement-actions">
                        <button class="btn btn--primary" id="newPOBtn">+ New Purchase Order</button>
                        <button class="btn btn--secondary" id="addVendorBtn">👥 Add Vendor</button>
                        <button class="btn btn--outline" id="exportProcurementBtn">Export Data</button>
                    </div>
                </div>

                <!-- Procurement KPIs -->
                <div class="procurement-kpi-grid">
                    <div class="kpi-card">
                        <div class="kpi-icon">💰</div>
                        <div class="kpi-content">
                            <div class="kpi-value">$456,789</div>
                            <div class="kpi-label">Monthly Spend</div>
                            <div class="kpi-change positive">-8.3%</div>
                        </div>
                    </div>
                    <div class="kpi-card">
                        <div class="kpi-icon">📋</div>
                        <div class="kpi-content">
                            <div class="kpi-value">23</div>
                            <div class="kpi-label">Active POs</div>
                            <div class="kpi-change positive">+12%</div>
                        </div>
                    </div>
                    <div class="kpi-card">
                        <div class="kpi-icon">🏭</div>
                        <div class="kpi-content">
                            <div class="kpi-value">47</div>
                            <div class="kpi-label">Active Vendors</div>
                            <div class="kpi-change positive">+3</div>
                        </div>
                    </div>
                    <div class="kpi-card">
                        <div class="kpi-icon">⚡</div>
                        <div class="kpi-content">
                            <div class="kpi-value">5.2</div>
                            <div class="kpi-label">Avg Lead Time (days)</div>
                            <div class="kpi-change negative">+0.8</div>
                        </div>
                    </div>
                </div>

                <!-- Vendor Management Section -->
                <div class="procurement-section">
                    <div class="section-header">
                        <h4>Vendor Management</h4>
                        <div class="section-actions">
                            <input type="text" class="form-control search-input" placeholder="Search vendors..." id="vendorSearchInput">
                            <select class="form-control" id="vendorCategoryFilter">
                                <option value="">All Categories</option>
                                <option value="construction">Construction Materials</option>
                                <option value="electrical">Electrical Supplies</option>
                                <option value="plumbing">Plumbing Supplies</option>
                                <option value="tools">Tools & Equipment</option>
                            </select>
                        </div>
                    </div>
                    <div class="vendor-grid">
                        <div class="vendor-card">
                            <div class="vendor-header">
                                <div class="vendor-info">
                                    <h4>BuildPro Materials Inc.</h4>
                                    <p>Construction Materials • Premium Supplier</p>
                                </div>
                                <div class="vendor-status">
                                    <span class="status-badge active">Active</span>
                                    <span class="vendor-rating">⭐ 4.8</span>
                                </div>
                            </div>
                            <div class="vendor-balance">
                                <div class="balance-label">Current Spend (YTD)</div>
                                <div class="balance-amount">$234,567</div>
                            </div>
                            <div class="vendor-details">
                                <div class="detail-item">
                                    <span class="detail-label">Payment Terms</span>
                                    <span class="detail-value">Net 30</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">Lead Time</span>
                                    <span class="detail-value">3-5 days</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">On-Time Delivery</span>
                                    <span class="detail-value">96.2%</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">Quality Score</span>
                                    <span class="detail-value">98.5%</span>
                                </div>
                            </div>
                        </div>
                        <div class="vendor-card">
                            <div class="vendor-header">
                                <div class="vendor-info">
                                    <h4>ElectriMax Supply Co.</h4>
                                    <p>Electrical Supplies • Certified Partner</p>
                                </div>
                                <div class="vendor-status">
                                    <span class="status-badge active">Active</span>
                                    <span class="vendor-rating">⭐ 4.6</span>
                                </div>
                            </div>
                            <div class="vendor-balance">
                                <div class="balance-label">Current Spend (YTD)</div>
                                <div class="balance-amount">$89,456</div>
                            </div>
                            <div class="vendor-details">
                                <div class="detail-item">
                                    <span class="detail-label">Payment Terms</span>
                                    <span class="detail-value">Net 15</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">Lead Time</span>
                                    <span class="detail-value">2-3 days</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">On-Time Delivery</span>
                                    <span class="detail-value">94.8%</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">Quality Score</span>
                                    <span class="detail-value">97.1%</span>
                                </div>
                            </div>
                        </div>
                        <div class="vendor-card">
                            <div class="vendor-header">
                                <div class="vendor-info">
                                    <h4>SteelWorks Direct</h4>
                                    <p>Steel & Metal Products • Preferred Vendor</p>
                                </div>
                                <div class="vendor-status">
                                    <span class="status-badge warning">Review</span>
                                    <span class="vendor-rating">⭐ 4.2</span>
                                </div>
                            </div>
                            <div class="vendor-balance">
                                <div class="balance-label">Current Spend (YTD)</div>
                                <div class="balance-amount">$156,789</div>
                            </div>
                            <div class="vendor-details">
                                <div class="detail-item">
                                    <span class="detail-label">Payment Terms</span>
                                    <span class="detail-value">Net 45</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">Lead Time</span>
                                    <span class="detail-value">7-10 days</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">On-Time Delivery</span>
                                    <span class="detail-value">87.3%</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">Quality Score</span>
                                    <span class="detail-value">92.6%</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Purchase Order Lifecycle -->
                <div class="procurement-section">
                    <div class="section-header">
                        <h4>Purchase Order Lifecycle</h4>
                        <div class="section-actions">
                            <select class="form-control" id="poStatusFilter">
                                <option value="">All Status</option>
                                <option value="draft">Draft</option>
                                <option value="pending-approval">Pending Approval</option>
                                <option value="approved">Approved</option>
                                <option value="sent">Sent to Vendor</option>
                                <option value="partial">Partially Received</option>
                                <option value="completed">Completed</option>
                            </select>
                        </div>
                    </div>
                    
                    <!-- PO Workflow Overview -->
                    <div class="po-workflow">
                        <div class="workflow-stage">
                            <div class="stage-icon">📝</div>
                            <div class="stage-info">
                                <div class="stage-title">Draft</div>
                                <div class="stage-count">5</div>
                            </div>
                        </div>
                        <div class="workflow-stage">
                            <div class="stage-icon">👀</div>
                            <div class="stage-info">
                                <div class="stage-title">Pending Approval</div>
                                <div class="stage-count">3</div>
                            </div>
                        </div>
                        <div class="workflow-stage">
                            <div class="stage-icon">✅</div>
                            <div class="stage-info">
                                <div class="stage-title">Approved</div>
                                <div class="stage-count">8</div>
                            </div>
                        </div>
                        <div class="workflow-stage">
                            <div class="stage-icon">📤</div>
                            <div class="stage-info">
                                <div class="stage-title">Sent</div>
                                <div class="stage-count">12</div>
                            </div>
                        </div>
                        <div class="workflow-stage">
                            <div class="stage-icon">📦</div>
                            <div class="stage-info">
                                <div class="stage-title">Receiving</div>
                                <div class="stage-count">7</div>
                            </div>
                        </div>
                    </div>

                    <!-- Active Purchase Orders -->
                    <div class="table-container">
                        <table class="data-table" id="purchaseOrderTable">
                            <thead>
                                <tr>
                                    <th>PO Number</th>
                                    <th>Vendor</th>
                                    <th>Date</th>
                                    <th>Total Amount</th>
                                    <th>Status</th>
                                    <th>Expected Delivery</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="purchaseOrderTableBody">
                                <!-- PO rows will be populated by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Approval Workflow -->
                <div class="procurement-section">
                    <div class="section-header">
                        <h4>Approval Workflow</h4>
                    </div>
                    <div class="approval-dashboard">
                        <div class="approval-stats">
                            <div class="approval-stat">
                                <span class="stat-number">3</span>
                                <span class="stat-description">Pending My Approval</span>
                            </div>
                            <div class="approval-stat">
                                <span class="stat-number">$45,678</span>
                                <span class="stat-description">Total Pending Value</span>
                            </div>
                            <div class="approval-stat">
                                <span class="stat-number">2.1</span>
                                <span class="stat-description">Avg Approval Time (days)</span>
                            </div>
                        </div>
                        <div class="approval-queue">
                            <h5>Items Requiring Approval</h5>
                            <div class="approval-list">
                                <div class="approval-item">
                                    <div class="approval-info">
                                        <span class="approval-title">PO-2025-001 - BuildPro Materials</span>
                                        <span class="approval-amount">$15,234.56</span>
                                    </div>
                                    <div class="approval-actions">
                                        <button class="btn btn--sm btn--outline approval-btn approve">✓ Approve</button>
                                        <button class="btn btn--sm btn--outline approval-btn reject">✗ Reject</button>
                                    </div>
                                </div>
                                <div class="approval-item">
                                    <div class="approval-info">
                                        <span class="approval-title">PO-2025-002 - ElectriMax Supply</span>
                                        <span class="approval-amount">$8,976.43</span>
                                    </div>
                                    <div class="approval-actions">
                                        <button class="btn btn--sm btn--outline approval-btn approve">✓ Approve</button>
                                        <button class="btn btn--sm btn--outline approval-btn reject">✗ Reject</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Inventory Tab -->
            <div class="supply-chain-tab" id="inventory" style="display: none;">
                <div class="inventory-header">
                    <h3>Inventory Management</h3>
                    <div class="inventory-actions">
                        <button class="btn btn--primary" id="addInventoryItemBtn">+ Add Item</button>
                        <button class="btn btn--secondary" id="bulkUpdateBtn">📊 Bulk Update</button>
                        <button class="btn btn--outline" id="exportInventoryReportBtn">Export Report</button>
                    </div>
                </div>

                <!-- Inventory KPIs -->
                <div class="inventory-kpi-grid">
                    <div class="kpi-card">
                        <div class="kpi-icon">📦</div>
                        <div class="kpi-content">
                            <div class="kpi-value">2,847</div>
                            <div class="kpi-label">Total SKUs</div>
                            <div class="kpi-change positive">+23</div>
                        </div>
                    </div>
                    <div class="kpi-card">
                        <div class="kpi-icon">💰</div>
                        <div class="kpi-content">
                            <div class="kpi-value">$1.2M</div>
                            <div class="kpi-label">Inventory Value</div>
                            <div class="kpi-change positive">+5.2%</div>
                        </div>
                    </div>
                    <div class="kpi-card">
                        <div class="kpi-icon">⚠️</div>
                        <div class="kpi-content">
                            <div class="kpi-value">47</div>
                            <div class="kpi-label">Low Stock Items</div>
                            <div class="kpi-change negative">+12</div>
                        </div>
                    </div>
                    <div class="kpi-card">
                        <div class="kpi-icon">🔄</div>
                        <div class="kpi-content">
                            <div class="kpi-value">4.2x</div>
                            <div class="kpi-label">Turnover Rate</div>
                            <div class="kpi-change positive">+0.3</div>
                        </div>
                    </div>
                </div>

                <!-- Warehouse Locations -->
                <div class="inventory-section">
                    <div class="section-header">
                        <h4>Warehouse Locations</h4>
                        <button class="btn btn--sm btn--outline" id="addWarehouseBtn">+ Add Location</button>
                    </div>
                    <div class="warehouse-grid">
                        <div class="warehouse-card">
                            <div class="warehouse-header">
                                <h5>🏭 Main Warehouse</h5>
                                <span class="warehouse-status operational">Operational</span>
                            </div>
                            <div class="warehouse-stats">
                                <div class="stat-item">
                                    <span class="stat-value">85%</span>
                                    <span class="stat-label">Capacity Used</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-value">1,247</span>
                                    <span class="stat-label">SKUs Stored</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-value">$847K</span>
                                    <span class="stat-label">Inventory Value</span>
                                </div>
                            </div>
                        </div>
                        <div class="warehouse-card">
                            <div class="warehouse-header">
                                <h5>🏪 Secondary Storage</h5>
                                <span class="warehouse-status operational">Operational</span>
                            </div>
                            <div class="warehouse-stats">
                                <div class="stat-item">
                                    <span class="stat-value">62%</span>
                                    <span class="stat-label">Capacity Used</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-value">893</span>
                                    <span class="stat-label">SKUs Stored</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-value">$356K</span>
                                    <span class="stat-label">Inventory Value</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Stock Level Monitoring -->
                <div class="inventory-section">
                    <div class="section-header">
                        <h4>Stock Level Monitoring</h4>
                        <div class="section-actions">
                            <input type="text" class="form-control search-input" placeholder="Search items..." id="inventorySearchInput">
                            <select class="form-control" id="stockLevelFilter">
                                <option value="">All Stock Levels</option>
                                <option value="critical">Critical (0-10%)</option>
                                <option value="low">Low (11-25%)</option>
                                <option value="normal">Normal (26-75%)</option>
                                <option value="high">High (75%+)</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="table-container">
                        <table class="data-table" id="inventoryTable">
                            <thead>
                                <tr>
                                    <th>SKU</th>
                                    <th>Product Name</th>
                                    <th>Category</th>
                                    <th>Current Stock</th>
                                    <th>Reorder Point</th>
                                    <th>Stock Level</th>
                                    <th>Location</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="inventoryTableBody">
                                <!-- Inventory rows will be populated by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Reorder & Replenishment -->
                <div class="inventory-section">
                    <div class="section-header">
                        <h4>Automated Replenishment</h4>
                        <button class="btn btn--sm btn--primary" id="configureReplenishmentBtn">⚙️ Configure Rules</button>
                    </div>
                    
                    <div class="replenishment-dashboard">
                        <div class="replenishment-stats">
                            <div class="replenishment-stat">
                                <span class="stat-number">23</span>
                                <span class="stat-description">Auto-Reorder Triggered</span>
                            </div>
                            <div class="replenishment-stat">
                                <span class="stat-number">$89,456</span>
                                <span class="stat-description">Pending Replenishment Value</span>
                            </div>
                            <div class="replenishment-stat">
                                <span class="stat-number">96.2%</span>
                                <span class="stat-description">Stock Availability Rate</span>
                            </div>
                        </div>
                        
                        <div class="reorder-queue">
                            <h5>Items Requiring Reorder</h5>
                            <div class="reorder-list">
                                <div class="reorder-item critical">
                                    <div class="reorder-info">
                                        <span class="reorder-sku">SKU-001</span>
                                        <span class="reorder-name">Portland Cement - Type I</span>
                                        <span class="reorder-level">Stock: 45 bags (Critical)</span>
                                    </div>
                                    <div class="reorder-actions">
                                        <button class="btn btn--sm btn--primary">🛒 Auto-Reorder</button>
                                        <button class="btn btn--sm btn--outline">📝 Manual PO</button>
                                    </div>
                                </div>
                                <div class="reorder-item warning">
                                    <div class="reorder-info">
                                        <span class="reorder-sku">SKU-045</span>
                                        <span class="reorder-name">Rebar #4 - 20ft</span>
                                        <span class="reorder-level">Stock: 156 pieces (Low)</span>
                                    </div>
                                    <div class="reorder-actions">
                                        <button class="btn btn--sm btn--primary">🛒 Auto-Reorder</button>
                                        <button class="btn btn--sm btn--outline">📝 Manual PO</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Logistics Tab -->
            <div class="supply-chain-tab" id="logistics" style="display: none;">
                <div class="logistics-header">
                    <h3>Logistics & Shipping</h3>
                    <div class="logistics-actions">
                        <button class="btn btn--primary" id="newShipmentBtn">+ New Shipment</button>
                        <button class="btn btn--secondary" id="schedulePickupBtn">🚚 Schedule Pickup</button>
                        <button class="btn btn--outline" id="exportLogisticsBtn">Export Data</button>
                    </div>
                </div>

                <!-- Logistics KPIs -->
                <div class="logistics-kpi-grid">
                    <div class="kpi-card">
                        <div class="kpi-icon">🚚</div>
                        <div class="kpi-content">
                            <div class="kpi-value">127</div>
                            <div class="kpi-label">Active Shipments</div>
                            <div class="kpi-change positive">+15</div>
                        </div>
                    </div>
                    <div class="kpi-card">
                        <div class="kpi-icon">🎯</div>
                        <div class="kpi-content">
                            <div class="kpi-value">94.8%</div>
                            <div class="kpi-label">On-Time Delivery</div>
                            <div class="kpi-change positive">+2.1%</div>
                        </div>
                    </div>
                    <div class="kpi-card">
                        <div class="kpi-icon">💰</div>
                        <div class="kpi-content">
                            <div class="kpi-value">$23,456</div>
                            <div class="kpi-label">Monthly Shipping Cost</div>
                            <div class="kpi-change negative">+8.5%</div>
                        </div>
                    </div>
                    <div class="kpi-card">
                        <div class="kpi-icon">↩️</div>
                        <div class="kpi-content">
                            <div class="kpi-value">12</div>
                            <div class="kpi-label">Returns Processing</div>
                            <div class="kpi-change negative">+3</div>
                        </div>
                    </div>
                </div>

                <!-- Shipment Tracking -->
                <div class="logistics-section">
                    <div class="section-header">
                        <h4>Shipment Tracking</h4>
                        <div class="section-actions">
                            <input type="text" class="form-control search-input" placeholder="Search shipments..." id="shipmentSearchInput">
                            <select class="form-control" id="shipmentStatusFilter">
                                <option value="">All Statuses</option>
                                <option value="pending">Pending Pickup</option>
                                <option value="in-transit">In Transit</option>
                                <option value="out-for-delivery">Out for Delivery</option>
                                <option value="delivered">Delivered</option>
                                <option value="exception">Exception</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="shipment-grid">
                        <div class="shipment-card">
                            <div class="shipment-header">
                                <div class="shipment-info">
                                    <h5>SH-2025-001</h5>
                                    <p>ABC Construction Co. • Order #ORD-456</p>
                                </div>
                                <div class="shipment-status">
                                    <span class="status-badge in-transit">In Transit</span>
                                </div>
                            </div>
                            <div class="shipment-details">
                                <div class="detail-row">
                                    <span class="detail-label">Carrier</span>
                                    <span class="detail-value">FedEx Freight</span>
                                </div>
                                <div class="detail-row">
                                    <span class="detail-label">Tracking #</span>
                                    <span class="detail-value">1234567890</span>
                                </div>
                                <div class="detail-row">
                                    <span class="detail-label">Est. Delivery</span>
                                    <span class="detail-value">Aug 28, 2025</span>
                                </div>
                                <div class="detail-row">
                                    <span class="detail-label">Current Location</span>
                                    <span class="detail-value">Phoenix, AZ Hub</span>
                                </div>
                            </div>
                            <div class="shipment-progress">
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: 75%;"></div>
                                </div>
                                <span class="progress-text">75% Complete</span>
                            </div>
                        </div>
                        
                        <div class="shipment-card">
                            <div class="shipment-header">
                                <div class="shipment-info">
                                    <h5>SH-2025-002</h5>
                                    <p>BuildRight LLC • Order #ORD-789</p>
                                </div>
                                <div class="shipment-status">
                                    <span class="status-badge out-for-delivery">Out for Delivery</span>
                                </div>
                            </div>
                            <div class="shipment-details">
                                <div class="detail-row">
                                    <span class="detail-label">Carrier</span>
                                    <span class="detail-value">UPS Ground</span>
                                </div>
                                <div class="detail-row">
                                    <span class="detail-label">Tracking #</span>
                                    <span class="detail-value">1Z999AA1234567890</span>
                                </div>
                                <div class="detail-row">
                                    <span class="detail-label">Est. Delivery</span>
                                    <span class="detail-value">Today by 6PM</span>
                                </div>
                                <div class="detail-row">
                                    <span class="detail-label">Current Location</span>
                                    <span class="detail-value">On Delivery Vehicle</span>
                                </div>
                            </div>
                            <div class="shipment-progress">
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: 95%;"></div>
                                </div>
                                <span class="progress-text">95% Complete</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Delivery Status Updates -->
                <div class="logistics-section">
                    <div class="section-header">
                        <h4>Recent Delivery Updates</h4>
                    </div>
                    
                    <div class="delivery-timeline">
                        <div class="timeline-item">
                            <div class="timeline-icon delivered">✓</div>
                            <div class="timeline-content">
                                <div class="timeline-header">
                                    <span class="timeline-title">Order #ORD-345 Delivered</span>
                                    <span class="timeline-time">2 hours ago</span>
                                </div>
                                <p class="timeline-description">Delivered to Home Depot - Signed by: Mike Johnson</p>
                            </div>
                        </div>
                        
                        <div class="timeline-item">
                            <div class="timeline-icon in-transit">🚚</div>
                            <div class="timeline-content">
                                <div class="timeline-header">
                                    <span class="timeline-title">Order #ORD-456 Out for Delivery</span>
                                    <span class="timeline-time">4 hours ago</span>
                                </div>
                                <p class="timeline-description">Package out for delivery - Expected by 6:00 PM</p>
                            </div>
                        </div>
                        
                        <div class="timeline-item">
                            <div class="timeline-icon exception">⚠️</div>
                            <div class="timeline-content">
                                <div class="timeline-header">
                                    <span class="timeline-title">Order #ORD-234 Delivery Exception</span>
                                    <span class="timeline-time">6 hours ago</span>
                                </div>
                                <p class="timeline-description">Address correction required - Customer contacted</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Returns Management -->
                <div class="logistics-section">
                    <div class="section-header">
                        <h4>Returns Management</h4>
                        <button class="btn btn--sm btn--outline" id="initiateReturnBtn">+ Initiate Return</button>
                    </div>
                    
                    <div class="returns-dashboard">
                        <div class="returns-stats">
                            <div class="returns-stat">
                                <span class="stat-number">12</span>
                                <span class="stat-description">Active Returns</span>
                            </div>
                            <div class="returns-stat">
                                <span class="stat-number">$8,450</span>
                                <span class="stat-description">Return Value (Monthly)</span>
                            </div>
                            <div class="returns-stat">
                                <span class="stat-number">2.3%</span>
                                <span class="stat-description">Return Rate</span>
                            </div>
                        </div>
                        
                        <div class="table-container">
                            <table class="data-table" id="returnsTable">
                                <thead>
                                    <tr>
                                        <th>Return ID</th>
                                        <th>Order #</th>
                                        <th>Customer</th>
                                        <th>Reason</th>
                                        <th>Status</th>
                                        <th>Value</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="returnsTableBody">
                                    <!-- Returns data will be populated by JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Carrier Performance -->
                <div class="logistics-section">
                    <div class="section-header">
                        <h4>Carrier Performance</h4>
                    </div>
                    
                    <div class="carrier-grid">
                        <div class="carrier-card">
                            <div class="carrier-header">
                                <h5>FedEx Freight</h5>
                                <span class="carrier-rating">⭐ 4.6/5</span>
                            </div>
                            <div class="carrier-stats">
                                <div class="stat-item">
                                    <span class="stat-value">96.2%</span>
                                    <span class="stat-label">On-Time Rate</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-value">$2.35</span>
                                    <span class="stat-label">Avg Cost/lb</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-value">0.2%</span>
                                    <span class="stat-label">Damage Rate</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="carrier-card">
                            <div class="carrier-header">
                                <h5>UPS Ground</h5>
                                <span class="carrier-rating">⭐ 4.4/5</span>
                            </div>
                            <div class="carrier-stats">
                                <div class="stat-item">
                                    <span class="stat-value">93.8%</span>
                                    <span class="stat-label">On-Time Rate</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-value">$2.28</span>
                                    <span class="stat-label">Avg Cost/lb</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-value">0.3%</span>
                                    <span class="stat-label">Damage Rate</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="carrier-card">
                            <div class="carrier-header">
                                <h5>Local Freight Co.</h5>
                                <span class="carrier-rating">⭐ 4.8/5</span>
                            </div>
                            <div class="carrier-stats">
                                <div class="stat-item">
                                    <span class="stat-value">98.1%</span>
                                    <span class="stat-label">On-Time Rate</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-value">$2.15</span>
                                    <span class="stat-label">Avg Cost/lb</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-value">0.1%</span>
                                    <span class="stat-label">Damage Rate</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Reports Module -->
        <div id="reports" class="module">
            <div class="module-header">
                <h2>Reports & Analytics</h2>
                <div class="module-actions">
                    <select class="form-control" id="reportPeriod">
                        <option value="30">Last 30 Days</option>
                        <option value="90">Last 90 Days</option>
                        <option value="365">Last Year</option>
                    </select>
                    <button class="btn btn--outline" id="exportReportBtn">Export PDF</button>
                </div>
            </div>

            <div class="reports-grid">
                <div class="report-card">
                    <h3>Revenue Analysis</h3>
                    <div class="chart-container" style="position: relative; height: 250px;">
                        <canvas id="revenueChart"></canvas>
                    </div>
                </div>
                <div class="report-card">
                    <h3>Inventory Turnover</h3>
                    <div class="chart-container" style="position: relative; height: 250px;">
                        <canvas id="turnoverChart"></canvas>
                    </div>
                </div>
                <div class="report-card">
                    <h3>Customer Segments</h3>
                    <div class="chart-container" style="position: relative; height: 250px;">
                        <canvas id="customerChart"></canvas>
                    </div>
                </div>
                <div class="report-card">
                    <h3>Product Performance</h3>
                    <div class="chart-container" style="position: relative; height: 250px;">
                        <canvas id="productChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Modal for detailed views -->
    <div id="modal" class="modal hidden">
        <div class="modal-backdrop" onclick="closeModal()"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle">Details</h3>
                <button class="modal-close" onclick="closeModal()">&times;</button>
            </div>
            <div class="modal-body" id="modalBody">
                <!-- Dynamic content will be inserted here -->
            </div>
        </div>
    </div>

    </div> <!-- End of main-app -->

    <!-- Notification Container -->
    <div id="notificationContainer" class="notification-container">
        <!-- Notifications will be dynamically inserted here -->
    </div>

    <!-- Notification Template -->
    <template id="notificationTemplate">
        <div class="notification" data-type="info">
            <div class="notification-icon">
                <span class="icon">ℹ️</span>
            </div>
            <div class="notification-content">
                <div class="notification-title">Title</div>
                <div class="notification-message">Message content</div>
                <div class="notification-timestamp">Just now</div>
            </div>
            <div class="notification-actions">
                <button class="notification-action primary" data-action="primary">Action</button>
                <button class="notification-close" data-action="close" title="Close">&times;</button>
            </div>
        </div>
    </template>

    
    <!-- PWA Installation & Service Worker Registration -->
    <script>
        // PWA Installation and Service Worker Registration
        let deferredPrompt;
        const installButton = document.createElement('button');
        installButton.textContent = '📱 Install App';
        installButton.className = 'btn btn--primary install-prompt';
        installButton.style.cssText = `
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
            display: none;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            border-radius: 25px;
            padding: 12px 20px;
            font-size: 14px;
            font-weight: 600;
        `;
        document.body.appendChild(installButton);
        
        // Service Worker Registration
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', async () => {
                try {
                    const registration = await navigator.serviceWorker.register('/service-worker.js');
                    console.log('✅ ServiceWorker registered successfully:', registration.scope);
                    
                    // Handle service worker updates
                    registration.addEventListener('updatefound', () => {
                        const newWorker = registration.installing;
                        if (newWorker) {
                            newWorker.addEventListener('statechange', () => {
                                if (newWorker.state === 'installed') {
                                    if (navigator.serviceWorker.controller) {
                                        // New update available
                                        showUpdateNotification();
                                    } else {
                                        // App is cached for offline use
                                        console.log('✅ App cached for offline use');
                                        showCachedNotification();
                                    }
                                }
                            });
                        }
                    });
                } catch (error) {
                    console.error('❌ ServiceWorker registration failed:', error);
                }
            });
            
            // Listen for messages from service worker
            navigator.serviceWorker.addEventListener('message', event => {
                const { type, action } = event.data || {};
                
                if (type === 'SYNC_COMPLETED') {
                    console.log('📡 Background sync completed:', action);
                    showSyncNotification(action);
                }
            });
        }
        
        // Enhanced PWA Install Experience
        let installPromptShown = false;
        let installBannerDismissed = localStorage.getItem('pwa-install-dismissed') === 'true';
        
        window.addEventListener('beforeinstallprompt', (e) => {
            console.log('💡 PWA install prompt available');
            e.preventDefault();
            deferredPrompt = e;
            
            // Show install prompts based on user engagement
            if (!installBannerDismissed && !installPromptShown) {
                setTimeout(() => showInstallBanner(), 10000); // Show after 10 seconds
            }
            showInstallButton();
        });
        
        // Handle install button click
        installButton.addEventListener('click', async () => {
            if (deferredPrompt) {
                hideInstallBanner();
                await showInstallModal();
            }
        });
        
        // Show enhanced install modal
        async function showInstallModal() {
            const modal = createInstallModal();
            document.body.appendChild(modal);
            
            return new Promise((resolve) => {
                const installBtn = modal.querySelector('#installModalConfirm');
                const cancelBtn = modal.querySelector('#installModalCancel');
                const closeBtn = modal.querySelector('#installModalClose');
                
                installBtn.addEventListener('click', async () => {
                    if (deferredPrompt) {
                        deferredPrompt.prompt();
                        const { outcome } = await deferredPrompt.userChoice;
                        console.log(`👤 PWA install prompt outcome: ${outcome}`);
                        
                        if (outcome === 'accepted') {
                            console.log('✅ User accepted PWA installation');
                            showInstallSuccessMessage();
                        } else {
                            console.log('❌ User declined PWA installation');
                        }
                        
                        deferredPrompt = null;
                        hideInstallButton();
                    }
                    document.body.removeChild(modal);
                    resolve(true);
                });
                
                [cancelBtn, closeBtn].forEach(btn => {
                    btn.addEventListener('click', () => {
                        document.body.removeChild(modal);
                        resolve(false);
                    });
                });
            });
        }
        
        // Handle successful app installation
        window.addEventListener('appinstalled', () => {
            console.log('🎉 PWA was installed successfully');
            hideInstallButton();
            showInstalledNotification();
        });
        
        // PWA Install Banner Functions
        function showInstallBanner() {
            if (installPromptShown) return;
            
            const banner = createInstallBanner();
            document.body.appendChild(banner);
            installPromptShown = true;
            
            setTimeout(() => {
                banner.style.transform = 'translateY(0)';
                banner.style.opacity = '1';
            }, 100);
            
            // Auto-hide after 10 seconds
            setTimeout(() => {
                if (banner.parentNode) {
                    hideInstallBanner();
                }
            }, 10000);
        }
        
        function hideInstallBanner() {
            const banner = document.getElementById('installBanner');
            if (banner) {
                banner.style.transform = 'translateY(-100%)';
                banner.style.opacity = '0';
                setTimeout(() => {
                    if (banner.parentNode) {
                        document.body.removeChild(banner);
                    }
                }, 300);
            }
        }
        
        function createInstallBanner() {
            const banner = document.createElement('div');
            banner.id = 'installBanner';
            banner.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                background: linear-gradient(135deg, #1FB8CD 0%, #1A9CB8 100%);
                color: white;
                padding: 12px 20px;
                z-index: 1002;
                transform: translateY(-100%);
                opacity: 0;
                transition: all 0.3s ease;
                box-shadow: 0 2px 12px rgba(0,0,0,0.15);
                display: flex;
                align-items: center;
                justify-content: space-between;
            `;
            
            banner.innerHTML = `
                <div style="display: flex; align-items: center; gap: 12px;">
                    <span style="font-size: 24px;">📱</span>
                    <div>
                        <div style="font-weight: 600; margin-bottom: 2px;">Install Construction ERP</div>
                        <div style="font-size: 13px; opacity: 0.9;">Get the full app experience with offline access</div>
                    </div>
                </div>
                <div style="display: flex; align-items: center; gap: 10px;">
                    <button id="installBannerBtn" style="
                        background: rgba(255,255,255,0.2);
                        border: 1px solid rgba(255,255,255,0.3);
                        color: white;
                        padding: 8px 16px;
                        border-radius: 6px;
                        font-size: 14px;
                        font-weight: 600;
                        cursor: pointer;
                        transition: background 0.2s ease;
                    ">Install Now</button>
                    <button id="dismissBannerBtn" style="
                        background: none;
                        border: none;
                        color: rgba(255,255,255,0.8);
                        font-size: 18px;
                        cursor: pointer;
                        padding: 4px;
                        border-radius: 4px;
                        transition: background 0.2s ease;
                    ">×</button>
                </div>
            `;
            
            // Add event listeners
            const installBtn = banner.querySelector('#installBannerBtn');
            const dismissBtn = banner.querySelector('#dismissBannerBtn');
            
            installBtn.addEventListener('click', () => {
                hideInstallBanner();
                showInstallModal();
            });
            
            dismissBtn.addEventListener('click', () => {
                localStorage.setItem('pwa-install-dismissed', 'true');
                hideInstallBanner();
            });
            
            // Add hover effects
            installBtn.addEventListener('mouseenter', () => {
                installBtn.style.background = 'rgba(255,255,255,0.3)';
            });
            installBtn.addEventListener('mouseleave', () => {
                installBtn.style.background = 'rgba(255,255,255,0.2)';
            });
            
            dismissBtn.addEventListener('mouseenter', () => {
                dismissBtn.style.background = 'rgba(255,255,255,0.1)';
            });
            dismissBtn.addEventListener('mouseleave', () => {
                dismissBtn.style.background = 'none';
            });
            
            return banner;
        }
        
        // PWA Helper Functions
        function showInstallButton() {
            installButton.style.display = 'block';
            setTimeout(() => {
                installButton.style.opacity = '1';
                installButton.style.transform = 'scale(1)';
            }, 100);
        }
        
        function hideInstallButton() {
            installButton.style.opacity = '0';
            installButton.style.transform = 'scale(0.9)';
            setTimeout(() => {
                installButton.style.display = 'none';
            }, 200);
        }
        
        function showUpdateNotification() {
            if (window.showNotification) {
                window.showNotification('🔄 App Update Available', 'A new version is available. Refresh to update.', 'info');
            } else {
                console.log('🔄 App update available - refresh to update');
            }
        }
        
        function showCachedNotification() {
            if (window.showNotification) {
                window.showNotification('📱 App Ready for Offline', 'Construction ERP is now available offline!', 'success');
            } else {
                console.log('📱 App cached for offline use');
            }
        }
        
        function showInstalledNotification() {
            if (window.showNotification) {
                window.showNotification('🎉 App Installed!', 'Construction ERP has been installed successfully.', 'success');
            } else {
                console.log('🎉 PWA installed successfully');
            }
        }
        
        function showSyncNotification(action) {
            if (window.showNotification) {
                window.showNotification('📡 Data Synced', `Your offline changes have been synchronized.`, 'success');
            } else {
                console.log('📡 Background sync completed:', action);
            }
        }
        
        // Create enhanced install modal
        function createInstallModal() {
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0, 0, 0, 0.7);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 1003;
                backdrop-filter: blur(4px);
            `;
            
            modal.innerHTML = `
                <div style="
                    background: white;
                    border-radius: 16px;
                    padding: 32px;
                    max-width: 480px;
                    width: 90%;
                    box-shadow: 0 20px 60px rgba(0,0,0,0.3);
                    text-align: center;
                    position: relative;
                ">
                    <button id="installModalClose" style="
                        position: absolute;
                        top: 16px;
                        right: 16px;
                        background: none;
                        border: none;
                        font-size: 24px;
                        color: #666;
                        cursor: pointer;
                        padding: 8px;
                        border-radius: 50%;
                        transition: background 0.2s ease;
                    ">&times;</button>
                    
                    <div style="margin-bottom: 24px;">
                        <div style="font-size: 64px; margin-bottom: 16px;">📱</div>
                        <h2 style="margin: 0 0 8px 0; color: #1FB8CD; font-size: 24px;">Install Construction ERP</h2>
                        <p style="margin: 0; color: #666; line-height: 1.5;">Transform your device into a powerful construction management hub</p>
                    </div>
                    
                    <div style="text-align: left; margin: 24px 0;">
                        <div style="display: flex; align-items: center; margin-bottom: 12px;">
                            <span style="color: #1FB8CD; font-size: 20px; margin-right: 12px;">📴</span>
                            <span style="color: #333;">Work offline without internet</span>
                        </div>
                        <div style="display: flex; align-items: center; margin-bottom: 12px;">
                            <span style="color: #1FB8CD; font-size: 20px; margin-right: 12px;">⚡</span>
                            <span style="color: #333;">Faster loading and performance</span>
                        </div>
                        <div style="display: flex; align-items: center; margin-bottom: 12px;">
                            <span style="color: #1FB8CD; font-size: 20px; margin-right: 12px;">🏠</span>
                            <span style="color: #333;">Home screen access like a native app</span>
                        </div>
                        <div style="display: flex; align-items: center;">
                            <span style="color: #1FB8CD; font-size: 20px; margin-right: 12px;">🔔</span>
                            <span style="color: #333;">Push notifications for important updates</span>
                        </div>
                    </div>
                    
                    <div style="display: flex; gap: 12px; margin-top: 32px;">
                        <button id="installModalCancel" style="
                            flex: 1;
                            background: #f3f4f6;
                            border: none;
                            padding: 12px 24px;
                            border-radius: 8px;
                            font-size: 16px;
                            font-weight: 600;
                            color: #374151;
                            cursor: pointer;
                            transition: background 0.2s ease;
                        ">Maybe Later</button>
                        <button id="installModalConfirm" style="
                            flex: 2;
                            background: linear-gradient(135deg, #1FB8CD 0%, #1A9CB8 100%);
                            border: none;
                            padding: 12px 24px;
                            border-radius: 8px;
                            font-size: 16px;
                            font-weight: 600;
                            color: white;
                            cursor: pointer;
                            transition: transform 0.2s ease;
                        ">Install Now</button>
                    </div>
                </div>
            `;
            
            // Add hover effects
            const cancelBtn = modal.querySelector('#installModalCancel');
            const confirmBtn = modal.querySelector('#installModalConfirm');
            const closeBtn = modal.querySelector('#installModalClose');
            
            cancelBtn.addEventListener('mouseenter', () => {
                cancelBtn.style.background = '#e5e7eb';
            });
            cancelBtn.addEventListener('mouseleave', () => {
                cancelBtn.style.background = '#f3f4f6';
            });
            
            confirmBtn.addEventListener('mouseenter', () => {
                confirmBtn.style.transform = 'scale(1.02)';
            });
            confirmBtn.addEventListener('mouseleave', () => {
                confirmBtn.style.transform = 'scale(1)';
            });
            
            closeBtn.addEventListener('mouseenter', () => {
                closeBtn.style.background = '#f3f4f6';
            });
            closeBtn.addEventListener('mouseleave', () => {
                closeBtn.style.background = 'none';
            });
            
            return modal;
        }
        
        // Show install success message with tutorial overlay
        function showInstallSuccessMessage() {
            const successModal = document.createElement('div');
            successModal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0, 0, 0, 0.8);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 1004;
                backdrop-filter: blur(4px);
            `;
            
            successModal.innerHTML = `
                <div style="
                    background: white;
                    border-radius: 16px;
                    padding: 40px;
                    max-width: 520px;
                    width: 90%;
                    box-shadow: 0 20px 60px rgba(0,0,0,0.3);
                    text-align: center;
                    animation: successSlideIn 0.4s ease-out;
                ">
                    <div style="color: #22c55e; font-size: 72px; margin-bottom: 16px;">🎉</div>
                    <h2 style="margin: 0 0 12px 0; color: #22c55e; font-size: 28px;">Installation Successful!</h2>
                    <p style="margin: 0 0 24px 0; color: #666; line-height: 1.6; font-size: 16px;">Construction ERP is now installed on your device. You can find it on your home screen and use it offline.</p>
                    
                    <div style="background: #f8fafc; border-radius: 12px; padding: 20px; margin: 24px 0; text-align: left;">
                        <h3 style="margin: 0 0 12px 0; color: #1e293b; font-size: 18px;">🚀 Quick Start Tips:</h3>
                        <ul style="margin: 0; padding-left: 20px; color: #475569; line-height: 1.6;">
                            <li>Find the app icon on your home screen</li>
                            <li>Works fully offline - no internet required</li>
                            <li>Data syncs automatically when online</li>
                            <li>Push notifications keep you updated</li>
                        </ul>
                    </div>
                    
                    <button id="tutorialStartBtn" style="
                        background: linear-gradient(135deg, #1FB8CD 0%, #1A9CB8 100%);
                        border: none;
                        padding: 14px 32px;
                        border-radius: 8px;
                        font-size: 16px;
                        font-weight: 600;
                        color: white;
                        cursor: pointer;
                        margin-right: 12px;
                        transition: transform 0.2s ease;
                    ">Start Tutorial</button>
                    
                    <button id="skipTutorialBtn" style="
                        background: none;
                        border: 1px solid #d1d5db;
                        padding: 14px 24px;
                        border-radius: 8px;
                        font-size: 16px;
                        color: #6b7280;
                        cursor: pointer;
                        transition: background 0.2s ease;
                    ">Skip for Now</button>
                </div>
            `;
            
            // Add animations
            const style = document.createElement('style');
            style.textContent = `
                @keyframes successSlideIn {
                    from {
                        opacity: 0;
                        transform: translateY(-20px) scale(0.95);
                    }
                    to {
                        opacity: 1;
                        transform: translateY(0) scale(1);
                    }
                }
            `;
            document.head.appendChild(style);
            
            document.body.appendChild(successModal);
            
            // Event listeners
            const tutorialBtn = successModal.querySelector('#tutorialStartBtn');
            const skipBtn = successModal.querySelector('#skipTutorialBtn');
            
            tutorialBtn.addEventListener('click', () => {
                document.body.removeChild(successModal);
                startOnboardingTutorial();
            });
            
            skipBtn.addEventListener('click', () => {
                document.body.removeChild(successModal);
            });
            
            // Hover effects
            tutorialBtn.addEventListener('mouseenter', () => {
                tutorialBtn.style.transform = 'scale(1.02)';
            });
            tutorialBtn.addEventListener('mouseleave', () => {
                tutorialBtn.style.transform = 'scale(1)';
            });
            
            skipBtn.addEventListener('mouseenter', () => {
                skipBtn.style.background = '#f9fafb';
            });
            skipBtn.addEventListener('mouseleave', () => {
                skipBtn.style.background = 'none';
            });
            
            // Auto-close after 15 seconds
            setTimeout(() => {
                if (successModal.parentNode) {
                    document.body.removeChild(successModal);
                }
            }, 15000);
        }
        
        // Network Status Monitoring
        function updateNetworkStatus() {
            const isOnline = navigator.onLine;
            const networkIndicator = document.getElementById('networkStatus') || createNetworkIndicator();
            
            if (isOnline) {
                networkIndicator.textContent = '🟢 Online';
                networkIndicator.className = 'network-status online';
            } else {
                networkIndicator.textContent = '🔴 Offline';
                networkIndicator.className = 'network-status offline';
            }
        }
        
        function createNetworkIndicator() {
            const indicator = document.createElement('div');
            indicator.id = 'networkStatus';
            indicator.style.cssText = `
                position: fixed;
                top: 10px;
                right: 10px;
                padding: 6px 12px;
                border-radius: 15px;
                font-size: 12px;
                font-weight: 600;
                z-index: 1001;
                transition: all 0.3s ease;
            `;
            
            // Add CSS classes for network status
            const style = document.createElement('style');
            style.textContent = `
                .network-status {
                    backdrop-filter: blur(10px);
                }
                .network-status.online {
                    background: rgba(34, 197, 94, 0.9);
                    color: white;
                }
                .network-status.offline {
                    background: rgba(239, 68, 68, 0.9);
                    color: white;
                    animation: pulse 2s infinite;
                }
                @keyframes pulse {
                    0%, 100% { opacity: 1; }
                    50% { opacity: 0.7; }
                }
                .install-prompt {
                    opacity: 0;
                    transform: scale(0.9);
                    transition: all 0.3s ease;
                }
            `;
            document.head.appendChild(style);
            document.body.appendChild(indicator);
            
            return indicator;
        }
        
        // Initialize network status
        window.addEventListener('online', updateNetworkStatus);
        window.addEventListener('offline', updateNetworkStatus);
        document.addEventListener('DOMContentLoaded', updateNetworkStatus);
        
        // API Server Integration Configuration
        const API_BASE_URL = 'http://localhost:3001';
        let vapidPublicKey = null;
        let pushSubscription = null;
        
        // Initialize API integration
        async function initializeAPIIntegration() {
            console.log('🔗 Initializing API server integration...');
            
            try {
                // Get VAPID public key from API server
                const response = await fetch(`${API_BASE_URL}/api/vapid-public-key`);
                if (response.ok) {
                    const data = await response.json();
                    vapidPublicKey = data.publicKey;
                    console.log('✅ VAPID public key retrieved');
                    
                    // Initialize push notifications if service worker is ready
                    if ('serviceWorker' in navigator) {
                        const registration = await navigator.serviceWorker.ready;
                        await initializePushNotifications(registration);
                    }
                } else {
                    console.warn('⚠️ API server not available for push notifications');
                }
            } catch (error) {
                console.warn('⚠️ API server connection failed:', error.message);
            }
        }
        
        // Initialize Push Notifications
        async function initializePushNotifications(registration) {
            if (!('PushManager' in window)) {
                console.warn('⚠️ Push notifications not supported');
                return;
            }
            
            try {
                // Check if already subscribed
                pushSubscription = await registration.pushManager.getSubscription();
                
                if (!pushSubscription && vapidPublicKey) {
                    // Request permission and subscribe
                    const permission = await Notification.requestPermission();
                    
                    if (permission === 'granted') {
                        console.log('✅ Notification permission granted');
                        await subscribeToPushNotifications(registration);
                    } else {
                        console.log('❌ Notification permission denied');
                    }
                } else if (pushSubscription) {
                    console.log('✅ Already subscribed to push notifications');
                }
            } catch (error) {
                console.error('❌ Push notification initialization failed:', error);
            }
        }
        
        // Subscribe to Push Notifications
        async function subscribeToPushNotifications(registration) {
            try {
                const applicationServerKey = urlBase64ToUint8Array(vapidPublicKey);
                
                pushSubscription = await registration.pushManager.subscribe({
                    userVisibleOnly: true,
                    applicationServerKey: applicationServerKey
                });
                
                // Send subscription to API server
                await fetch(`${API_BASE_URL}/api/subscribe`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(pushSubscription)
                });
                
                console.log('✅ Subscribed to push notifications');
                showNotification('Push Notifications Enabled', 'You will now receive important updates!', 'success');
                
            } catch (error) {
                console.error('❌ Failed to subscribe to push notifications:', error);
            }
        }
        
        // Helper function to convert VAPID key
        function urlBase64ToUint8Array(base64String) {
            const padding = '='.repeat((4 - base64String.length % 4) % 4);
            const base64 = (base64String + padding).replace(/-/g, '+').replace(/_/g, '/');
            const rawData = window.atob(base64);
            const outputArray = new Uint8Array(rawData.length);
            
            for (let i = 0; i < rawData.length; ++i) {
                outputArray[i] = rawData.charCodeAt(i);
            }
            return outputArray;
        }
        
        // Data Synchronization Functions
        async function syncDataWithServer() {
            try {
                console.log('🔄 Syncing data with server...');
                
                // Get latest data from server
                const response = await fetch(`${API_BASE_URL}/api/sync/data`);
                if (response.ok) {
                    const serverData = await response.json();
                    
                    // Store server data locally
                    localStorage.setItem('server-sync-data', JSON.stringify(serverData));
                    localStorage.setItem('last-sync-timestamp', new Date().toISOString());
                    
                    console.log('✅ Data synchronized with server');
                    showNotification('Data Synchronized', 'Latest data has been synced from server', 'info');
                    
                    // Update UI if needed
                    if (typeof updateDashboardData === 'function') {
                        updateDashboardData(serverData);
                    }
                    
                    return serverData;
                }
            } catch (error) {
                console.warn('⚠️ Data sync failed:', error.message);
            }
            return null;
        }
        
        // Upload offline changes to server
        async function uploadOfflineChanges() {
            try {
                const offlineChanges = JSON.parse(localStorage.getItem('offline-changes') || '{}');
                
                if (Object.keys(offlineChanges).length === 0) {
                    console.log('📝 No offline changes to upload');
                    return;
                }
                
                console.log('📤 Uploading offline changes...');
                
                const response = await fetch(`${API_BASE_URL}/api/sync/upload`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(offlineChanges)
                });
                
                if (response.ok) {
                    const result = await response.json();
                    console.log('✅ Offline changes uploaded:', result);
                    
                    // Clear offline changes after successful upload
                    localStorage.removeItem('offline-changes');
                    
                    showNotification('Changes Synced', `${result.processed || 0} changes uploaded to server`, 'success');
                    
                    // Refresh data after upload
                    await syncDataWithServer();
                }
            } catch (error) {
                console.warn('⚠️ Failed to upload offline changes:', error.message);
            }
        }
        
        // Store data changes offline when server is unavailable
        function storeOfflineChange(type, data, action = 'create') {
            const offlineChanges = JSON.parse(localStorage.getItem('offline-changes') || '{}');
            
            if (!offlineChanges[type]) {
                offlineChanges[type] = [];
            }
            
            offlineChanges[type].push({
                ...data,
                action,
                timestamp: new Date().toISOString(),
                id: data.id || 'temp-' + Date.now()
            });
            
            localStorage.setItem('offline-changes', JSON.stringify(offlineChanges));
            console.log(`💾 Stored ${type} change offline:`, action);
        }
        
        // Network status change handler
        function handleNetworkChange() {
            if (navigator.onLine) {
                console.log('🌐 Back online - syncing data...');
                setTimeout(() => {
                    uploadOfflineChanges().then(() => syncDataWithServer());
                }, 1000); // Small delay to ensure stable connection
            } else {
                console.log('📵 Gone offline - switching to offline mode');
                showNotification('Offline Mode', 'Working offline. Changes will sync when reconnected.', 'warning');
            }
        }
        
        // Enhanced network event listeners
        window.addEventListener('online', handleNetworkChange);
        window.addEventListener('offline', handleNetworkChange);
        
        // Initialize API integration when page loads
        document.addEventListener('DOMContentLoaded', () => {
            setTimeout(initializeAPIIntegration, 1000); // Small delay to ensure DOM is ready
        });
        
        // Manual cache refresh function
        window.refreshCache = function() {
            if ('serviceWorker' in navigator && navigator.serviceWorker.controller) {
                navigator.serviceWorker.controller.postMessage({ type: 'CACHE_UPDATE' });
                console.log('🔄 Cache refresh requested');
            }
        };
        
        // Manual data sync function
        window.syncData = function() {
            console.log('🔄 Manual data sync requested');
            syncDataWithServer();
        };
        
        // Test push notification function
        window.testPushNotification = async function() {
            try {
                const response = await fetch(`${API_BASE_URL}/api/send-notification`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        title: 'Test Notification 🧪',
                        message: 'This is a test push notification from the Construction ERP system!',
                        type: 'info',
                        data: {
                            action: 'test',
                            timestamp: new Date().toISOString()
                        }
                    })
                });
                
                if (response.ok) {
                    const result = await response.json();
                    console.log('✅ Test notification sent:', result);
                } else {
                    console.error('❌ Failed to send test notification');
                }
            } catch (error) {
                console.error('❌ Test notification error:', error);
            }
        };
        
        // Add keyboard shortcut for cache refresh (Ctrl/Cmd + Shift + R)
        document.addEventListener('keydown', (e) => {
            if ((e.ctrlKey || e.metaKey) && e.shiftKey && e.key === 'R') {
                e.preventDefault();
                window.refreshCache();
            }
        });
        
        // Onboarding tutorial system
        function startOnboardingTutorial() {
            const tutorialSteps = [
                {
                    target: '.sidebar',
                    title: 'Navigation Menu',
                    content: 'Use this sidebar to navigate between different modules of the ERP system.'
                },
                {
                    target: '.kpi-grid',
                    title: 'Key Performance Indicators',
                    content: 'Monitor your business performance at a glance with these live KPI cards.'
                },
                {
                    target: '#quickOrderBtn',
                    title: 'Quick Actions',
                    content: 'Access frequently used actions directly from the header for faster workflow.'
                },
                {
                    target: '.insights-panel',
                    title: 'AI Insights',
                    content: 'Get intelligent recommendations and alerts based on your business data.'
                }
            ];
            
            let currentStep = 0;
            const overlay = createTutorialOverlay();
            document.body.appendChild(overlay);
            
            function showStep(stepIndex) {
                if (stepIndex >= tutorialSteps.length) {
                    endTutorial();
                    return;
                }
                
                const step = tutorialSteps[stepIndex];
                const targetElement = document.querySelector(step.target);
                
                if (!targetElement) {
                    showStep(stepIndex + 1);
                    return;
                }
                
                highlightElement(targetElement, step, stepIndex, tutorialSteps.length);
            }
            
            function highlightElement(element, step, stepIndex, totalSteps) {
                const rect = element.getBoundingClientRect();
                const tooltip = overlay.querySelector('.tutorial-tooltip');
                const spotlight = overlay.querySelector('.tutorial-spotlight');
                
                // Position spotlight
                spotlight.style.left = `${rect.left - 10}px`;
                spotlight.style.top = `${rect.top - 10}px`;
                spotlight.style.width = `${rect.width + 20}px`;
                spotlight.style.height = `${rect.height + 20}px`;
                
                // Position and update tooltip
                tooltip.innerHTML = `
                    <div class="tutorial-header">
                        <h3>${step.title}</h3>
                        <span class="tutorial-progress">${stepIndex + 1} / ${totalSteps}</span>
                    </div>
                    <p>${step.content}</p>
                    <div class="tutorial-controls">
                        <button class="tutorial-btn tutorial-skip">Skip Tutorial</button>
                        <div>
                            ${stepIndex > 0 ? '<button class="tutorial-btn tutorial-back">Back</button>' : ''}
                            <button class="tutorial-btn tutorial-next">
                                ${stepIndex === totalSteps - 1 ? 'Finish' : 'Next'}
                            </button>
                        </div>
                    </div>
                `;
                
                // Position tooltip
                const tooltipRect = tooltip.getBoundingClientRect();
                let tooltipTop = rect.bottom + 20;
                let tooltipLeft = rect.left + (rect.width / 2) - (tooltipRect.width / 2);
                
                // Adjust if tooltip would be off-screen
                if (tooltipTop + tooltipRect.height > window.innerHeight) {
                    tooltipTop = rect.top - tooltipRect.height - 20;
                }
                if (tooltipLeft < 10) tooltipLeft = 10;
                if (tooltipLeft + tooltipRect.width > window.innerWidth - 10) {
                    tooltipLeft = window.innerWidth - tooltipRect.width - 10;
                }
                
                tooltip.style.left = `${tooltipLeft}px`;
                tooltip.style.top = `${tooltipTop}px`;
                
                // Event listeners
                const nextBtn = tooltip.querySelector('.tutorial-next');
                const backBtn = tooltip.querySelector('.tutorial-back');
                const skipBtn = tooltip.querySelector('.tutorial-skip');
                
                nextBtn.addEventListener('click', () => {
                    currentStep++;
                    showStep(currentStep);
                });
                
                if (backBtn) {
                    backBtn.addEventListener('click', () => {
                        currentStep--;
                        showStep(currentStep);
                    });
                }
                
                skipBtn.addEventListener('click', endTutorial);
            }
            
            function endTutorial() {
                document.body.removeChild(overlay);
                localStorage.setItem('pwa-tutorial-completed', 'true');
                showNotification('✅ Tutorial Complete!', 'You\'re all set to use Construction ERP.', 'success');
            }
            
            // Start the tutorial
            showStep(0);
        }
        
        function createTutorialOverlay() {
            const overlay = document.createElement('div');
            overlay.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0, 0, 0, 0.7);
                z-index: 1005;
                pointer-events: none;
            `;
            
            overlay.innerHTML = `
                <div class="tutorial-spotlight" style="
                    position: absolute;
                    background: rgba(255, 255, 255, 0.05);
                    border: 2px solid #1FB8CD;
                    border-radius: 8px;
                    box-shadow: 0 0 0 9999px rgba(0, 0, 0, 0.7), 0 0 20px rgba(31, 184, 205, 0.5);
                    transition: all 0.3s ease;
                    pointer-events: none;
                "></div>
                
                <div class="tutorial-tooltip" style="
                    position: absolute;
                    background: white;
                    border-radius: 12px;
                    padding: 24px;
                    max-width: 320px;
                    box-shadow: 0 12px 32px rgba(0, 0, 0, 0.3);
                    pointer-events: auto;
                    font-family: inherit;
                ">
                    <!-- Content will be populated dynamically -->
                </div>
            `;
            
            // Add tutorial-specific styles
            const style = document.createElement('style');
            style.textContent = `
                .tutorial-header {
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    margin-bottom: 12px;
                }
                .tutorial-header h3 {
                    margin: 0;
                    color: #1FB8CD;
                    font-size: 18px;
                }
                .tutorial-progress {
                    background: #f3f4f6;
                    color: #6b7280;
                    padding: 2px 8px;
                    border-radius: 12px;
                    font-size: 12px;
                    font-weight: 600;
                }
                .tutorial-tooltip p {
                    margin: 0 0 20px 0;
                    color: #4b5563;
                    line-height: 1.5;
                }
                .tutorial-controls {
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                }
                .tutorial-btn {
                    padding: 8px 16px;
                    border: none;
                    border-radius: 6px;
                    font-size: 14px;
                    font-weight: 600;
                    cursor: pointer;
                    transition: all 0.2s ease;
                }
                .tutorial-skip {
                    background: none;
                    color: #6b7280;
                }
                .tutorial-skip:hover {
                    color: #374151;
                }
                .tutorial-back {
                    background: #f3f4f6;
                    color: #374151;
                    margin-right: 8px;
                }
                .tutorial-back:hover {
                    background: #e5e7eb;
                }
                .tutorial-next {
                    background: #1FB8CD;
                    color: white;
                }
                .tutorial-next:hover {
                    background: #1A9CB8;
                    transform: translateY(-1px);
                }
            `;
            document.head.appendChild(style);
            
            return overlay;
        }
        
        console.log('🏗️ Construction ERP PWA initialized');
    </script>
    
    <!-- Offline Storage Manager -->
    <script src="offline-storage.js"></script>
    
    <!-- Notification Manager -->
    <script src="notification-manager.js"></script>
    
    <!-- PWA Storage Integration -->
    <script>
        // Initialize offline storage manager and notification manager
        let offlineStorage = null;
        let notificationManager = null;
        
        document.addEventListener('DOMContentLoaded', async () => {
            try {
                // Initialize the offline storage manager
                offlineStorage = new OfflineStorageManager();
                window.offlineStorage = offlineStorage; // Make it globally available
                
                // Initialize the notification manager
                notificationManager = new NotificationManager();
                window.notificationManager = notificationManager; // Make it globally available
                window.showNotification = (title, message, type) => notificationManager.showInAppNotification(title, message, type);
                
                console.log('💾 Offline storage manager initialized');
                console.log('🔔 Notification manager initialized');
                
                // Load cached data when offline or on startup
                await loadCachedData();
                
                // Listen for sync completion events
                window.addEventListener('erp-sync-completed', (event) => {
                    console.log('📡 Sync completed:', event.detail);
                    showSyncNotification('completed');
                    // Refresh UI with updated data
                    refreshUIData();
                });
                
                // Listen for storage events
                window.addEventListener('erp-data-updated', (event) => {
                    console.log('💾 Data updated locally:', event.detail);
                    // Update relevant UI components
                    updateUIComponent(event.detail);
                });
                
                // Setup periodic data refresh when online
                if (navigator.onLine) {
                    setInterval(async () => {
                        if (navigator.onLine && offlineStorage) {
                            await refreshDataFromServer();
                        }
                    }, 300000); // Every 5 minutes
                }
                
            } catch (error) {
                console.error('❌ Failed to initialize offline storage:', error);
                // Fallback to online-only mode
                showNotification('⚠️ Offline Mode Unavailable', 'Running in online-only mode.', 'warning');
            }
        });
        
        // Load cached data into UI
        async function loadCachedData() {
            if (!offlineStorage) return;
            
            try {
                // Load products
                const products = await offlineStorage.getData(offlineStorage.storeName.PRODUCTS);
                if (products && products.length > 0) {
                    window.productsData = products;
                    if (typeof populateProducts === 'function') {
                        populateProducts(products);
                    }
                    console.log('📦 Loaded', products.length, 'products from offline storage');
                }
                
                // Load customers
                const customers = await offlineStorage.getData(offlineStorage.storeName.CUSTOMERS);
                if (customers && customers.length > 0) {
                    window.customersData = customers;
                    if (typeof populateCustomers === 'function') {
                        populateCustomers(customers);
                    }
                    console.log('👥 Loaded', customers.length, 'customers from offline storage');
                }
                
                // Load app state
                const appState = await offlineStorage.getAppState();
                if (appState && Object.keys(appState).length > 0) {
                    // Restore UI state
                    restoreUIState(appState);
                    console.log('🔄 Restored app state from offline storage');
                }
                
                // Load user preferences
                const userPrefs = await offlineStorage.getUserPreferences();
                if (userPrefs && Object.keys(userPrefs).length > 0) {
                    applyUserPreferences(userPrefs);
                    console.log('⚙️ Applied user preferences from offline storage');
                }
                
            } catch (error) {
                console.error('❌ Failed to load cached data:', error);
            }
        }
        
        // Refresh data from server when online
        async function refreshDataFromServer() {
            if (!offlineStorage || !navigator.onLine) return;
            
            try {
                // This would typically call your actual API endpoints
                console.log('🔄 Refreshing data from server (placeholder)');
                
                // For demo purposes, we'll just log this
                // In a real app, you'd make API calls here and update the offline storage
                
                // Example of how you might update products:
                // const response = await fetch('/api/products');
                // if (response.ok) {
                //     const products = await response.json();
                //     for (const product of products) {
                //         await offlineStorage.saveData(offlineStorage.storeName.PRODUCTS, product, true);
                //     }
                // }
                
            } catch (error) {
                console.warn('⚠️ Failed to refresh data from server:', error);
            }
        }
        
        // Refresh UI with updated data
        async function refreshUIData() {
            await loadCachedData();
        }
        
        // Update specific UI component based on data change
        function updateUIComponent(dataInfo) {
            const { storeName, action, data } = dataInfo;
            
            switch (storeName) {
                case 'products':
                    if (typeof updateProductInUI === 'function') {
                        updateProductInUI(data, action);
                    }
                    break;
                case 'customers':
                    if (typeof updateCustomerInUI === 'function') {
                        updateCustomerInUI(data, action);
                    }
                    break;
                case 'orders':
                    if (typeof updateOrderInUI === 'function') {
                        updateOrderInUI(data, action);
                    }
                    break;
            }
        }
        
        // Restore UI state from cached data
        function restoreUIState(state) {
            try {
                // Restore active tab
                if (state.activeTab) {
                    const tab = document.querySelector(`[data-tab="${state.activeTab}"]`);
                    if (tab && typeof switchTab === 'function') {
                        switchTab(state.activeTab);
                    }
                }
                
                // Restore form data
                if (state.formData) {
                    Object.entries(state.formData).forEach(([fieldId, value]) => {
                        const field = document.getElementById(fieldId);
                        if (field) {
                            field.value = value;
                        }
                    });
                }
                
                // Restore filters
                if (state.filters) {
                    Object.entries(state.filters).forEach(([filterId, value]) => {
                        const filter = document.getElementById(filterId);
                        if (filter) {
                            filter.value = value;
                        }
                    });
                }
                
            } catch (error) {
                console.warn('⚠️ Failed to restore UI state:', error);
            }
        }
        
        // Apply user preferences
        function applyUserPreferences(prefs) {
            try {
                // Apply theme preferences
                if (prefs.theme) {
                    document.body.className = prefs.theme === 'dark' ? 'dark-mode' : '';
                }
                
                // Apply other preferences
                if (prefs.defaultView) {
                    // Switch to preferred default view
                }
                
                if (prefs.notifications !== undefined) {
                    // Apply notification preferences
                }
                
            } catch (error) {
                console.warn('⚠️ Failed to apply user preferences:', error);
            }
        }
        
        // Save current UI state
        window.saveUIState = async function() {
            if (!offlineStorage) return;
            
            try {
                const state = {
                    activeTab: getCurrentActiveTab(),
                    formData: getCurrentFormData(),
                    filters: getCurrentFilters(),
                    timestamp: new Date().toISOString()
                };
                
                await offlineStorage.saveAppState(state);
                console.log('💾 UI state saved to offline storage');
            } catch (error) {
                console.error('❌ Failed to save UI state:', error);
            }
        };
        
        // Save user preferences
        window.saveUserPreferences = async function(preferences) {
            if (!offlineStorage) return;
            
            try {
                await offlineStorage.saveUserPreferences(preferences);
                console.log('⚙️ User preferences saved to offline storage');
            } catch (error) {
                console.error('❌ Failed to save user preferences:', error);
            }
        };
        
        // Utility functions to get current UI state
        function getCurrentActiveTab() {
            const activeTab = document.querySelector('.nav-item.active');
            return activeTab ? activeTab.getAttribute('data-tab') : 'dashboard';
        }
        
        function getCurrentFormData() {
            const formData = {};
            const forms = document.querySelectorAll('form');
            forms.forEach(form => {
                const formElements = form.querySelectorAll('input, select, textarea');
                formElements.forEach(element => {
                    if (element.id && element.value) {
                        formData[element.id] = element.value;
                    }
                });
            });
            return formData;
        }
        
        function getCurrentFilters() {
            const filters = {};
            const filterElements = document.querySelectorAll('[id*="Filter"], [id*="Search"]');
            filterElements.forEach(element => {
                if (element.id && element.value) {
                    filters[element.id] = element.value;
                }
            });
            return filters;
        }
        
        // Add offline-aware data saving functions
        window.saveProductOffline = async function(productData) {
            if (!offlineStorage) {
                console.warn('Offline storage not available');
                return null;
            }
            
            try {
                const result = await offlineStorage.saveData(
                    offlineStorage.storeName.PRODUCTS, 
                    productData
                );
                
                // Notify UI
                window.dispatchEvent(new CustomEvent('erp-data-updated', { 
                    detail: { 
                        storeName: 'products', 
                        action: 'save', 
                        data: productData 
                    } 
                }));
                
                console.log('💾 Product saved offline:', productData.id || productData.sku);
                return result;
            } catch (error) {
                console.error('❌ Failed to save product offline:', error);
                return null;
            }
        };
        
        window.saveCustomerOffline = async function(customerData) {
            if (!offlineStorage) {
                console.warn('Offline storage not available');
                return null;
            }
            
            try {
                const result = await offlineStorage.saveData(
                    offlineStorage.storeName.CUSTOMERS, 
                    customerData
                );
                
                // Notify UI
                window.dispatchEvent(new CustomEvent('erp-data-updated', { 
                    detail: { 
                        storeName: 'customers', 
                        action: 'save', 
                        data: customerData 
                    } 
                }));
                
                console.log('💾 Customer saved offline:', customerData.id || customerData.name);
                return result;
            } catch (error) {
                console.error('❌ Failed to save customer offline:', error);
                return null;
            }
        };
        
        // Add offline-aware data searching
        window.searchProductsOffline = async function(filters = {}) {
            if (!offlineStorage) return [];
            
            try {
                const results = await offlineStorage.searchData(
                    offlineStorage.storeName.PRODUCTS, 
                    filters
                );
                console.log('🔍 Found', results.length, 'products matching filters');
                return results;
            } catch (error) {
                console.error('❌ Failed to search products offline:', error);
                return [];
            }
        };
        
        window.searchCustomersOffline = async function(filters = {}) {
            if (!offlineStorage) return [];
            
            try {
                const results = await offlineStorage.searchData(
                    offlineStorage.storeName.CUSTOMERS, 
                    filters
                );
                console.log('🔍 Found', results.length, 'customers matching filters');
                return results;
            } catch (error) {
                console.error('❌ Failed to search customers offline:', error);
                return [];
            }
        };
        
        // Get storage statistics for debugging
        window.getStorageStats = async function() {
            if (!offlineStorage) {
                console.warn('Offline storage not available');
                return null;
            }
            
            try {
                const stats = await offlineStorage.getStorageStats();
                console.table(stats);
                return stats;
            } catch (error) {
                console.error('❌ Failed to get storage stats:', error);
                return null;
            }
        };
        
        // Clear all offline data (for testing/reset)
        window.clearOfflineData = async function() {
            if (!offlineStorage) {
                console.warn('Offline storage not available');
                return;
            }
            
            if (confirm('Are you sure you want to clear all offline data? This cannot be undone.')) {
                try {
                    await offlineStorage.clearAllData();
                    console.log('🧹 All offline data cleared');
                    showNotification('✅ Data Cleared', 'All offline data has been cleared.', 'success');
                    // Reload the page to reset the UI
                    setTimeout(() => window.location.reload(), 1000);
                } catch (error) {
                    console.error('❌ Failed to clear offline data:', error);
                    showNotification('❌ Clear Failed', 'Failed to clear offline data.', 'error');
                }
            }
        };
        
        // Auto-save UI state periodically
        setInterval(() => {
            if (document.hasFocus() && offlineStorage) {
                saveUIState();
            }
        }, 60000); // Every minute when tab is active
        
        // Save UI state when page is about to unload
        window.addEventListener('beforeunload', () => {
            if (offlineStorage) {
                saveUIState();
            }
        });
        
        console.log('🏗️ PWA Offline Storage integration initialized');
    </script>
</body>
</html>
